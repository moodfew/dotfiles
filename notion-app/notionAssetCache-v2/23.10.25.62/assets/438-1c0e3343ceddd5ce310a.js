"use strict";(self.webpackChunknotion_next=self.webpackChunknotion_next||[]).push([[438],{30438:(e,t,s)=>{s.d(t,{Z:()=>D});var i=s(77094),a=s.n(i),o=s(97464),r=s.n(o),n=s(77422),l=s.n(n),c=(s(33948),s(67294)),d=s.n(c),h=s(83355),u=s(480),p=s(28350),g=s(8848),m=s(59054),S=s(3779),y=s(27006),f=s(21202),v=s(29369),P=s(5366),k=s(65452),Z=s(28020),b=s(81997),I=s(38755),M=s(27832),C=s(9714),w=s(12318),T=s(48762),x=s(82970),A=s(62727),E=s(68932),z=s(25584),B=s(86671),L=s(40039),q=s(79029),R=s(14694);class F extends B.Z{renderComponent(){const{isMobile:e,nestingLevel:t}=this.props;return d().createElement(T.Z,r()({},this.props,{title:a()(R.Z,{childrenStyle:F.sidebarChildrenStyle,left:this.renderLeftCheckbox(),icon:this.renderIcon(),isMobile:e,style:{marginLeft:8*t}},void 0,this.renderTitle())}))}renderLeftCheckbox(){return a()(x.Z,{size:16,checked:this.props.isChecked,onClick:this.props.onClick})}renderIcon(){const{store:e,isMobile:t}=this.props,s=e.getIcon();return a()(L.Z,{disabled:!0,icon:s,title:void 0,isEmptyPage:e.isEmptyPage(),size:t?24:20,pageIconStyle:{fill:this.theme.mediumIconColor}})}renderTitle(){return a()(q.Z,{store:this.props.store})}}l()(F,"sidebarChildrenStyle",{display:"flex",alignItems:"center"});const N=F;var W=s(97880),_=s(31299),O=s(78948),U=s(71202),H=s(16328),V=s(24042),G=s(83071);function K(e){const{spaceId:t,onSelectPage:s,query:i,source:o,findSelectedBlockAncestorId:n}=e,l=(0,u.O7)();let c=null;const[{status:h,value:p}]=(0,m.r5)((async()=>await _.kz({environment:l,query:i,limit:10,requireEditPermissions:!0,spaceId:t,excludeTemplates:!0,source:o})),[l,i,t,o],{debounce:_.vp});if("idle"===h||"pending"===h)c=a()(G.Z,{},void 0,a()(O.Z,{}));else{const e=((null==p?void 0:p.results)||[]).map((e=>{let{id:t}=e;const i=new C.Z(l,{table:f.iU,id:t});return function(e){const{store:t,environment:s,alreadySelectedAncestorId:i,onSelectPage:o}=e;if(i&&i===t.id)return{key:t.id,action:()=>{},render:e=>d().createElement(V.Z,r()({},e,{store:t,hidePath:!0,disabled:!0,style:{opacity:.5},caption:a()(P.FormattedMessage,{id:"oauthPageSearchResults.disabledResult.bySelf.message",defaultMessage:"Already added"})}))};if(i){const e=new C.Z(s,{table:f.iU,id:i});return{key:t.id,action:()=>{},render:s=>d().createElement(V.Z,r()({},s,{store:t,hidePath:!0,disabled:!0,style:{opacity:.5},caption:a()(P.FormattedMessage,{id:"oauthPageSearchResults.disabledResult.byAncestor.message",defaultMessage:"Already added via {ancestorPageName}",values:{ancestorPageName:a()(q.Z,{store:e,style:{display:"inline"}})}})}))}}const n=t.getRole();return n&&y.zz(n)?{key:t.id,action:()=>o(t.id),render:e=>d().createElement(V.Z,r()({store:t,hidePath:!1},e))}:void 0}({store:i,alreadySelectedAncestorId:n(i),environment:l,onSelectPage:s})})).filter(W.$K);c=0===e.length?a()(G.Z,{},void 0,a()(H.Z,{title:a()(P.FormattedMessage,{id:"oauthPageSearchResults.noResults.placeholder",defaultMessage:"No results"})})):function(e){return a()(z.Z,{type:z.Z.Type.Vertical,initialFocus:void 0,sections:[{key:"results",items:e,render:e=>d().createElement(G.Z,e)}]})}(e)}const g={menuType:U.ZP.MenuType.Popup};return d().createElement(U.ZP,g,c)}var Q=s(66722);class j extends h.Z{constructor(){super(...arguments),l()(this,"storeTypes",{selectedBlockIdsStore:w.Z.of({}),searchStore:w.Z.of({open:!1,query:void 0})}),l()(this,"getPageSection",((e,t,s)=>{const i=s.filter((e=>y.zz(e.getRole()||"none")));return{key:e,render:e=>d().createElement(G.Z,e),items:[this.getPageSectionHeader(t,i),...0===i.length?[this.getEmptyState()]:i.map((e=>this.getPageItem(e,1)))]}})),l()(this,"getPageItem",((e,t)=>{const{selectedBlockIdsStore:s}=this.stores,{device:i}=this.environment,a=Boolean(s.state[e.id]);return{key:e.id,action:()=>this.props.onClickPage(e.id,a),render:s=>d().createElement(N,r()({},s,{isMobile:i.isMobile,store:e,isChecked:a,disabled:!1,nestingLevel:t}))}})),l()(this,"getPageSectionHeader",((e,t)=>{const{selectedBlockIdsStore:s}=this.stores,{device:i}=this.environment,o=t.length>0&&t.every((e=>s.state[e.id]));return{key:e,action:()=>this.props.onClickSection(t),render:t=>d().createElement(T.Z,r()({},t,{title:a()(R.Z,{left:a()(x.Z,{onClick:t.onClick,checked:o,size:16}),isMobile:i.isMobile,style:this.getSectionHeaderStyle()},void 0,e)}))}})),l()(this,"getEmptyState",(()=>{const{device:e}=this.environment;return{key:"empty",action:()=>{},render:t=>d().createElement(T.Z,r()({},t,{title:a()(R.Z,{isMobile:e.isMobile,style:{fontSize:14,color:this.theme.mediumTextColor,padding:"2px 32px"}},void 0,a()(P.FormattedMessage,{id:"oauthAuthorizationPage.selectPageStep.empty",defaultMessage:"No pages inside"}))}))}})),l()(this,"handleSearchQueryChange",(e=>{const t=this.stores.searchStore.state,s=e.length>0;this.stores.searchStore.setState({...t,query:e,open:s})})),l()(this,"handleSearchCancel",(()=>{const e=this.stores.searchStore.state;this.stores.searchStore.setState({...e,open:!1,query:void 0})})),l()(this,"findSelectedBlockAncestorId",(e=>{const{selectedBlockIdsStore:t}=this.stores;if(t.state[e.id])return e.id;const s=b.fJ(e).find((e=>e.table===f.iU&&Boolean(t.state[e.value.id])));return s?s.value.id:void 0}))}renderComponent(){const{intl:e}=this.props,{searchStore:t,selectedBlockIdsStore:s}=this.stores,{device:i}=this.environment,o=(0,Z.k_)(this.environment).state;if(!o)return a()(E.Z,{style:{alignSelf:"center"}});const{allSharedPagesStores:n,showWorkspaceSection:l,showTeamSection:c,showSharedSection:h,showPrivateSection:u,showOnlyPrivateSection:p}=o,{currentSpaceViewStore:g,currentSpaceStore:m}=M.default.state;if(!g||!m)return;const y=[];if(c){const e=g.getTeamsStores();y.push(...e.map((e=>[e,e.getTeamPagesStores().filter((e=>e.state.value&&"copy_indicator"!==e.state.value.type))])))}const k=g.getWorkspacePages().filter((e=>e.state.value&&"copy_indicator"!==e.state.value.type)),b=g.getPrivatePages(this.environment).filter((e=>e.state.value&&"copy_indicator"!==e.state.value.type)),w=Object.keys(s.state).filter((e=>s.state[e])).map((e=>new C.Z(this.environment,{table:f.iU,id:e}))).filter((e=>{var t;return(null===(t=e.state.value)||void 0===t?void 0:t.space_id)===m.id&&e.isNavigableBlock()&&!e.isTopLevelPrivatePage(m.id,this.environment)&&!e.isTopLevelWorkspacePage(m.id)&&!(e.getParentTable()===v.e0)&&!n.some((t=>t.id===e.id))})),T=(0,I.getSpaceName)(this.environment,m),x=[];if(w.length>0&&x.push({key:"manual",render:e=>d().createElement(G.Z,r()({},e,{title:a()(R.Z,{isMobile:i.isMobile,style:this.getSectionHeaderStyle()},void 0,a()(P.FormattedMessage,{id:"oauthAuthorizationPage.selectPagesStep.pagePicker.manuallyAddedPagesSection.title",defaultMessage:"Manually added"})),isTitleUppercase:!0})),items:w.map((e=>this.getPageItem(e,0)))}),l&&x.push(this.getPageSection("workspace",e.formatMessage({id:"oauthAuthorizationPage.selectPagesStep.pagePicker.workspaceSection.title",defaultMessage:"Workspace",description:"This word is used in the same context as the title for the Workspace section of the sidebar."}),k)),c)for(const[a,r]of y){const e=a.state.value;e&&x.push(this.getPageSection("team-".concat(e.id),e.name,r))}if(h&&x.push(this.getPageSection("shared",e.formatMessage({id:"oauthAuthorizationPage.selectPagesStep.pagePicker.sharedSection.title",defaultMessage:"Shared",description:"This word is used in the same context as the title for the Shared section of the sidebar."}),n)),u){const t=p?T||"":e.formatMessage({id:"oauthAuthorizationPage.selectPagesStep.pagePicker.privateSection.title",defaultMessage:"Private",description:"This word is used in the same context as the title for the Private section of the sidebar."});x.push(this.getPageSection("private",t,b))}return d().createElement(d().Fragment,null,a()(Q.GI,{origin:a()(A.Z,{focus:!0,focusAfterAnimation:!0,value:t.state.query||"",onChange:e=>{this.handleSearchQueryChange(e.target.value)},left:S.Z.searchThick(this.getSearchIconStyle()),placeholder:e.formatMessage({id:"oauthAuthorizationPage.selectPagesStep.pagePicker.search.placeholder",defaultMessage:"Search for pages in {workspaceName}"},{workspaceName:T})}),sameWidthAsOrigin:!0,popupType:Q.GI.PopupType.Popup,open:t.state.open,render:()=>a()(K,{spaceId:m.id,onSelectPage:e=>this.props.onClickPage(e,!1),query:t.state.query||"",source:"oauth",findSelectedBlockAncestorId:this.findSelectedBlockAncestorId}),onDismiss:this.handleSearchCancel}),a()("div",{style:this.getPageListStyle()},void 0,a()(z.Z,{type:z.Z.Type.Vertical,sections:x,initialFocus:void 0})))}getSectionHeaderStyle(){return{textTransform:"uppercase",fontSize:12,fontWeight:600,color:this.theme.mediumTextColor,padding:"2px 0"}}getPageListStyle(){return{alignItems:"left",width:"100%",height:380,borderWidth:1,borderStyle:"solid",borderColor:g.ZP.contentBorder,overflowY:"auto"}}getSearchIconStyle(){return{width:14,height:14,marginLeft:8,marginRight:8,flexGrow:0,flexShrink:0,fill:this.theme.mediumIconColor}}}const D=function(e){const t=(0,u.O7)(),s=(0,p.VK)((()=>{var e;return null===(e=M.default.state.currentSpaceStore)||void 0===e?void 0:e.id}),[]),i=t.currentUser.id,o=(0,P.useIntl)(),[{status:n}]=(0,m.r5)((async()=>{s&&i&&await(0,k.lO)({environment:t,spaceId:s,userId:i})}),[t,s,i]);return"pending"===n||"idle"===n?a()(E.Z,{style:{alignSelf:"center"}}):d().createElement(j,r()({intl:o},e))}}}]);