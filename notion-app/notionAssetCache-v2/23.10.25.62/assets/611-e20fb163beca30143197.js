"use strict";(self.webpackChunknotion_next=self.webpackChunknotion_next||[]).push([[611],{68611:(e,t,i)=>{i.r(t),i.d(t,{default:()=>B});var n=i(77094),o=i.n(n),s=i(77422),r=i.n(s),a=(i(33948),i(96486)),l=i.n(a),d=i(67294),c=i.n(d),u=i(39249),h=i(83355),p=i(8848),m=i(3779),f=i(89101),g=i(82990),y=i(77671),v=i(26111),S=i(95477),w=i(74570),C=i(28020),R=i(45023),b=i(33846),k=i(27683),Z=i(28121),I=i(36360),x=i(62727),V=i(28240),E=i(47966);i(27369);class M extends h.Z{constructor(){super(...arguments),r()(this,"searchRef",c().createRef()),r()(this,"firstApiRef",c().createRef()),r()(this,"apiSectionRefs",{find:c().createRef(),pricing:c().createRef(),recovery:c().createRef(),security:c().createRef(),rateLimits:c().createRef(),experiments:c().createRef(),findAdminLogs:c().createRef(),utilities:c().createRef(),integrations:c().createRef(),marketing:c().createRef()}),r()(this,"storeTypes",{searchStore:b.Z}),r()(this,"scrollToSection",(e=>{const t=this.apiSectionRefs[e];t.current&&t.current.scrollIntoView()})),r()(this,"handleKeyDown",(e=>{(0,R.Z)(this.environment,e,"command+/")&&(e.preventDefault(),this.stores.searchStore.reset(),this.searchRef.current&&this.searchRef.current.focusInput())})),r()(this,"handleLogOut",(()=>{y.B(this.environment)})),r()(this,"filterStore",this.createComputedStore((()=>{const e=this.stores.searchStore.state.inputValue.toLowerCase();if(!(e.length<=1))try{return new RegExp(e,"i")}catch(t){return void console.error("Can't filter with invalid regex \"".concat(e,'"'),t)}})))}didMount(){window.addEventListener("keydown",this.handleKeyDown)}willUnmount(){window.removeEventListener("keydown",this.handleKeyDown)}renderComponent(){const e=(0,C.S4)(this.environment),{searchStore:t}=this.stores,i=(0,w.v2)(),n=i?w.Fr:w.Fr.filter((e=>"full"!==e.requiresRole)),s=this.filterStore.state,r=void 0!==s?n.filter((e=>(0,w.H2)(e,s))):n;let a=!0;const l=w.KC.map((e=>{const t=r.filter((t=>t.sectionName===e)).map((e=>{const t=a?this.firstApiRef:void 0;return a=!1,c().createElement(k.Z,{style:M.itemStyle,ref:t,key:e.apiName,api:e})}));return this.renderSection({key:e,title:w._c[e].title,children:t})}));return o()(I.Z,{title:"Notion Admin Mode"},void 0,o()("div",{style:M.wrapStyle},void 0,o()("div",{style:M.style},void 0,o()("div",{style:M.itemStyle},void 0,o()("div",{style:M.headerStyle},void 0,"Notion ",!i&&"Restricted"," Admin Mode"," ","production"!==S.default.env?"(".concat(S.default.env,")"):void 0),o()("div",{style:{marginBottom:12}},void 0,o()(V.Z,{href:"https://dev.notion.so/notion/Use-Admin-Mode-05f1e0ad9aa749a4b3dc07410b499465",external:!0,inline:!0,underline:!0},void 0,"Click here")," ","to learn more about how to use Admin Mode."),o()("div",{style:{display:"flex"}},void 0,e&&o()("div",{style:{flex:1}},void 0,"Currently Logged in as: ",e.email),!e&&o()("div",{style:M.warningTextStyle},void 0,o()(V.Z,{innerStyle:{textDecoration:"underline"},href:f._j.login},void 0,"Please log in.")),e&&o()(E.Z,{onClick:this.handleLogOut,style:{height:"auto"}},void 0,"Log Out")),i&&o()(Z.Z,{}),!i&&o()(E.Z,{onClick:()=>{(0,v.navigate)({environment:this.environment,url:"/"})},style:{marginTop:12,display:"flex",alignItems:"center"}},void 0,m.Z.arrowLeft({width:12,height:12,marginRight:12}),"Navigate to user workspace")),o()("div",{style:M.itemStyle},void 0,o()("div",{style:{fontWeight:g.Z.fontWeight.bold,fontSize:18,marginBottom:6}},void 0,"Go to (cmd-/)"),o()("div",{style:{marginBottom:14,display:"flex"}},void 0,c().createElement(x.Z,{showClearButton:!0,placeholder:"Filter, then press enter to jump",ref:this.searchRef,focusInitial:!0,value:this.stores.searchStore.state.inputValue,onChange:e=>{t.setState({...t.state,inputValue:e.target.value})},left:m.Z.searchThick({width:14,height:14,marginRight:6,flexGrow:0,flexShrink:0,fill:p.Vx().mediumIconColor}),onSubmit:()=>{this.firstApiRef.current&&this.firstApiRef.current.focus()}})),w.KC.map((e=>o()("div",{style:{marginTop:6}},e,o()(V.Z,{onClick:()=>this.scrollToSection(e),underline:!0},void 0,w._c[e].title))))),l,r.length<n.length&&o()("div",{style:{opacity:.7,width:"100%",color:p.Vx().lightIconColor,margin:8,fontStyle:"italic"}},void 0,n.length-r.length,' hidden. To show all, press Cmd-/ or click "Clear" above.',o()("br",{}),this.randomQuip())),o()(u.Ix,{hideProgressBar:!0,autoClose:1500,transition:u.Mi})))}renderSection(e){const{title:t,children:i,key:n}=e;if(i&&(!Array.isArray(i)||i.length))return c().createElement("div",{ref:this.apiSectionRefs[n],id:n,key:n,style:{...M.style,marginTop:12,marginBottom:12,width:"100%"}},o()("div",{style:{...M.headerStyle,width:"100%",marginLeft:M.itemStyle.margin}},void 0,t),i)}randomQuip(){return l().sample(["Hi, spam duplicate","Your hair is looking so nice today!",'"The faster we are at getting botter, the faster we get botter" - Doug EngelBot',"You're doing a great job, keep it up!!","Computing for everyone","Remember to take a stretch break every once in a while"])}}r()(M,"wrapStyle",{height:"100vh",overflow:"auto",background:p.Vx().sidebarBackground,padding:8}),r()(M,"style",{display:"flex",flexWrap:"wrap"}),r()(M,"headerStyle",{fontWeight:g.Z.fontWeight.bold,fontSize:36}),r()(M,"itemStyle",{width:500,padding:18,margin:8,border:"1px solid ".concat(p.Vx().outlineButtonBorder),background:"white",position:"relative"}),r()(M,"warningTextStyle",{fontWeight:g.Z.fontWeight.bold,color:"red"});const B=M},27683:(e,t,i)=>{i.d(t,{Z:()=>_});var n=i(97464),o=i.n(n),s=i(77422),r=i.n(s),a=i(77094),l=i.n(a),d=(i(33948),i(41817),i(85827),i(60285),i(96486)),c=i.n(d),u=i(67294),h=i.n(u),p=i(83355),m=i(480),f=i(8848),g=i(4615),y=i(89101),v=i(97880),S=i(82990),w=i(5366),C=i(61269),R=i(92625),b=i(53471),k=i(74570),Z=i(77907),I=i(49085);class x extends I.Z{getInitialState(){return{inputValues:{}}}}const V=x;var E=i(12318),M=i(3104),B=i(48762),L=i(82970),A=i(6958),T=i(62727),U=i(28240),N=i(68932),j=i(15102),F=i(47966),D=i(79583),O=i(46951);function K(e){const{fieldName:t,acceptMultiple:i,store:n}=e,[o,s]=(0,u.useState)((()=>({isUploading:!1,errorMessage:void 0,uploadedFileUrls:[]}))),r=(0,m.O7)();return h().createElement(h().Fragment,null,l()(F.Z,{isLarge:!0,style:{width:"fit-content",backgroundColor:"white"},onClick:()=>{(0,b.cR)({multiple:!!i,environment:r,onStart:()=>{s({...o,isUploading:!0,errorMessage:void 0,uploadedFileUrls:[]})},bucket:"public",onError:e=>{s({isUploading:!1,errorMessage:e.message,uploadedFileUrls:[]})},onComplete:e=>{s({isUploading:!1,errorMessage:void 0,uploadedFileUrls:e}),n.setState({response:void 0,inputValues:{...n.state.inputValues,[t]:i?e:e[0]}})},accept:"image/*"})}},void 0,i?"Upload images":"Upload image",o.isUploading&&l()(N.Z,{style:{marginLeft:4}})),o.uploadedFileUrls&&l()("div",{},void 0,o.uploadedFileUrls.join(",")),o.errorMessage&&l()("div",{style:{color:f.ZP.red,display:"inline-flex",marginLeft:8}},void 0,o.errorMessage))}const z=(0,w.defineMessages)({loading:{id:"adminAPIRequest.loadingMessage",defaultMessage:"Loadingâ€¦"}});class W extends p.Z{constructor(){super(...arguments),r()(this,"firstInputRef",h().createRef()),r()(this,"fileInputRef",h().createRef()),r()(this,"storeTypes",{store:V,fileNameStore:E.Z.of("")}),r()(this,"renderKey",((e,t,i)=>{const{store:n}=this.stores,s=n.state.inputValues[t],r=0===i?this.firstInputRef:void 0;let a;if(e.type===k.It.String)a=h().createElement(T.Z,{ref:r,value:"string"==typeof s?s:"",showClearButton:!0,onChange:e=>{n.setState({response:void 0,inputValues:{...n.state.inputValues,[t]:e.target.value}})},onSubmit:this.handleSubmit,onClearButtonClick:()=>{n.setState({response:void 0,inputValues:{...n.state.inputValues,[t]:void 0}})}});else if(e.type===k.It.Number)a=h().createElement(T.Z,{ref:r,type:"number",value:"number"==typeof s?s.toString():"",onChange:e=>{n.setState({response:void 0,inputValues:{...n.state.inputValues,[t]:parseInt(e.target.value)}})},onSubmit:this.handleSubmit});else if(e.type===k.It.Options){const i=[W.undefinedKey,...e.options],r={menuTitle:t,items:i,selectedItem:s,onSelect:e=>{n.setState({response:void 0,inputValues:{...n.state.inputValues,[t]:e===W.undefinedKey?void 0:e}})},getKey:e=>e,renderItem:e=>h().createElement(B.Z,o()({},e,{title:e.value===W.undefinedKey?"Empty":e.value})),renderOrigin:e=>h().createElement(F.Z,o()({isLarge:!0,style:{marginBottom:8}},e),s||"Empty"),width:300};a=h().createElement(D.Z,r)}else if(e.type===k.It.Boolean)a=l()(L.Z,{checked:Boolean(s),size:20,onClick:e=>{n.setState({response:void 0,inputValues:{...n.state.inputValues,[t]:!Boolean(s)}})}});else if(e.type===k.It.Csv)a=h().createElement(h().Fragment,null,l()(F.Z,{isLarge:!0,onClick:()=>{var e,t;null===(e=this.fileInputRef)||void 0===e||null===(t=e.current)||void 0===t||t.click()},style:{marginRight:10}},void 0,"Upload"),this.stores.fileNameStore.state,h().createElement("input",{ref:this.fileInputRef,style:{display:"none"},type:"file",name:e.name||"csv file",onChange:e=>this.handleOnChangeCsvFile(t,e)}));else if(e.type===k.It.Image||e.type===k.It.Images){const i=e.type===k.It.Images;a=l()(K,{fieldName:t,acceptMultiple:i,store:n})}else(0,v.t1)(e);return l()("div",{},t,l()("div",{style:{marginTop:12,marginBottom:4}},void 0,c().startCase(t)),e.comment&&l()(O.Z,{isSmall:!0,isMultiline:!0,style:{marginTop:4,marginBottom:8}},void 0,e.comment),a)})),r()(this,"handleOnChangeCsvFile",(async(e,t)=>{const{store:i,fileNameStore:n}=this.stores,o=t.target.files;if(null==o||!o.length)return;const s=o[0],r=await s.text();n.set(s.name),i.setState({response:void 0,inputValues:{...i.state.inputValues,[e]:r}})})),r()(this,"handleSubmit",(()=>{this.props.api.confirmationApiName?this.handleConfirm():this.handleConfirmedSubmit()})),r()(this,"handleConfirm",(()=>{const{store:e}=this.stores,{confirmationApiName:t,schema:i}=this.props.api,{inputValues:n}=e.state;if(!t)throw new Error("Should not have gotten here without a confirmationApiName");const o=this.normalizeInputValues(n,i);R.j({message:z.loading});const s=C[t];if(!s)throw new Error("Missing api handler for ".concat(t," - likely either a typo in client/helpers/adminHelpers.tsx or missing declaration in client/actions/api.ts"));s(this.environment,o).then((t=>{R.x(),e.setState({...e.state,confirmationResponse:t})}))})),r()(this,"handleConfirmedSubmit",(()=>{const{store:e}=this.stores,{apiName:t,schema:i}=this.props.api,{inputValues:n}=e.state,o=this.normalizeInputValues(n,i);R.j({message:z.loading});const s=C[t];if(!s)throw new Error("Missing api handler for ".concat(t," - likely either a typo in client/helpers/adminHelpers.tsx or missing declaration in client/actions/api.ts"));s(this.environment,o).then((t=>{R.x(),this.downloadAsCsv(t)||e.setState({...e.state,confirmationResponse:void 0,response:t})}))})),r()(this,"handleCancel",(()=>{const{store:e}=this.stores;e.setState({inputValues:e.state.inputValues})})),r()(this,"handleModalDismiss",(()=>{const{store:e}=this.stores;e.state.response&&("failed"===e.state.response.type?e.setState({inputValues:e.state.inputValues}):this.resetStoreState(this.props))}))}willMount(e){this.resetStoreState(e)}didMount(){this.shouldShowInline()&&this.handleSubmit()}renderComponent(){const{api:e,defaultParams:t,style:i}=this.props,{apiName:n,displayName:o,schema:s,description:r,emoji:a,isDestructive:d,requiresRole:u}=e,{confirmationResponse:p,response:m}=this.stores.store.state;return l()("div",{style:i},void 0,l()("div",{style:W.headerStyle},void 0,l()(A.Z,{size:24,emoji:a}),l()("span",{style:{marginLeft:4}},void 0,o||c().startCase(n))),r&&l()(O.Z,{isSmall:!0,isMultiline:!0},void 0,r),!this.shouldShowInline()&&h().createElement(h().Fragment,null,Object.entries(s).map(((e,i)=>{let[n,o]=e;return t&&t[n]?void 0:this.renderKey(o,n,i)})),l()(F.Z,{style:{marginTop:8,marginBottom:8},isLarge:!0,onClick:this.handleSubmit,isRed:d},void 0,"Submit")),this.shouldShowInline()&&!m&&l()("div",{},void 0,l()(N.Z,{style:{width:18,height:18}}),"Loading ..."),this.renderError(p),this.renderConfirmation(p),this.renderError(m),this.renderResponse(m),"full"===u&&l()("div",{style:W.footerStyle},void 0,"Full Admin Tool"))}renderConfirmation(e){if(e&&"success"===e.type)return l()(j.Z,{open:!0,innerStyle:W.modalStyle,onDismiss:this.handleCancel,disableAnimation:!0,render:()=>h().createElement(h().Fragment,null,l()(O.Z,{isSmall:!0,isMultiline:!0,style:{marginBottom:8}},void 0,"Does this information about the action you're about to take look good to you? Hit Confirm if it does. Cancel if not."),l()(Z.LazyAdminReactJson,{data:e.data}),l()(F.Z,{style:{marginTop:8,marginBottom:8},isLarge:!0,onClick:this.handleConfirmedSubmit},void 0,"Confirm"),l()(F.Z,{style:{marginTop:8,marginBottom:8,marginLeft:8},isLarge:!0,onClick:this.handleCancel},void 0,"Cancel"))})}renderError(e){if(e&&"success"!==e.type)return 401===e.status?l()("div",{style:W.responseErrorStyle},void 0,e.body.message," Likely fixed by"," ",l()(U.Z,{innerStyle:{textDecoration:"underline"},href:y._j.login},void 0,"signing in.")):l()("div",{style:W.responseErrorStyle},void 0,e.body.message)}renderResponse(e){if(!e||"success"!==e.type)return;const t=this.props.api.customResponseRenderer?l()(this.props.api.customResponseRenderer,{data:e.data,environment:this.environment,singleRecordMode:this.props.singleRecordMode}):l()(M.Z,{data:e.data});return this.shouldShowInline()?t:l()(j.Z,{open:Boolean(e&&"success"===e.type),innerStyle:W.modalStyle,onDismiss:this.handleModalDismiss,disableAnimation:!0,render:()=>t})}focus(){this.firstInputRef.current&&this.firstInputRef.current.focusInput()}downloadAsCsv(e){if(n=e,Boolean("success"===n.type&&Array.isArray(null===(o=n.data)||void 0===o?void 0:o.rows)&&(null===(s=n.data)||void 0===s?void 0:s.rows.length)>0&&"string"==typeof(null===(r=n.data)||void 0===r?void 0:r.filename))){const{filename:n,rows:o}=e.data,s=Array.from(o.reduce(((e,t)=>(Object.keys(t).forEach((t=>e.add(t))),e)),new Set)),r=[s];for(const e of o){const t=new Array(s.length);for(let i=0;i<t.length;i++){const n=s[i];t[i]=e[n]}r.push(t)}const a=r.map((e=>e.join(","))).join("\n");var t=new Blob([a],{type:"data:text/csv"}),i=window.URL.createObjectURL(t);const l=document.createElement("a");return l.download=n,l.href=i,l.click(),!0}var n,o,s,r;return!1}shouldShowInline(){const{showByDefault:e,singleRecordMode:t}=this.props;return e&&t}resetStoreState(e){const{defaultParams:t}=e,{store:i}=this.stores,n={};for(const o of Object.keys(e.api.schema)){const i=e.api.schema[o];t&&t[o]?n[o]=t[o]:i&&void 0!==i.defaultValue?n[o]=i.defaultValue:n[o]=void 0}i.setState({inputValues:n})}normalizeInputValues(e,t){const i={};for(const n of Object.keys(e)){const o=e[n];t[n]&&(c().isString(o)&&g.qn(o)?i[n]=g.wr(o):i[n]=o)}return i}}r()(W,"undefinedKey","__undefined"),r()(W,"headerStyle",{fontWeight:S.Z.fontWeight.bold,fontSize:20,display:"flex",alignItems:"center",marginBottom:6}),r()(W,"footerStyle",{fontSize:10,position:"absolute",bottom:7,right:20}),r()(W,"responseErrorStyle",{color:f.ZP.red,display:"inline-block",marginLeft:8}),r()(W,"modalStyle",{width:"calc(100% - 120px)",height:"calc(100% - 120px)",padding:24,fontSize:"1.2em",overflow:"scroll"});const _=W},27369:()=>{}}]);