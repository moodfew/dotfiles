(self.webpackChunknotion_next=self.webpackChunknotion_next||[]).push([[878],{87867:(e,r,t)=>{"use strict";t.r(r),t.d(r,{formulaToString:()=>i});t(15306);var n=t(81602),a=t(82293),o=t(24429),s=t(63143);function i(e,r){if(!e)return"";const t=m(e,r);if(!t)return"";const n=t.toString({parenthesis:"auto"});return n.replace(/\\/g,"\\\\").replace(/\n/g,"\\n").replace(/\t/g,"\\t")}const p=n.U(a.$),u=(0,s.Q8)(o._G,(e=>e.value)),l=(0,s.Q8)(o.Gn,(e=>e.apply)),f=(0,s.Q8)(o.wk,(e=>e.apply));function m(e,r){if(!e)return p.uninitialized;if("conditional"===e.type)return new p.ConditionalNode(m(e.condition,r),m(e.true,r),m(e.false,r));if("constant"===e.type){const r="number"===e.value_type?parseFloat(e.value):"boolean"===e.value_type?e.value||"true"===e.value:e.value;return new p.ConstantNode(r)}if("function"===e.type)return new p.FunctionNode(new p.SymbolNode(e.name),(e.args||[]).map((e=>m(e,r))).filter((e=>void 0!==e)));if("operator"===e.type)return new p.OperatorNode(e.operator,e.name,(e.args||[]).map((e=>m(e,r))).filter((e=>void 0!==e)));if("property"===e.type){const t=r[e.id],n=t?t.name:e.name;return new p.FunctionNode("prop",[new p.ConstantNode(n)])}return"symbol"===e.type?new p.SymbolNode(e.name):p.uninitialized}p.import(u,{override:!0}),p.import(l,{override:!0}),p.import(f,{override:!0})},15962:(e,r,t)=>{"use strict";t.r(r),t.d(r,{stringToFormula:()=>d});t(73210),t(85827);var n=t(96486),a=t.n(n),o=t(81602),s=t(82293),i=t(7406),p=t(26666),u=t(24429),l=t(87867);const f=/(.+) \(char (\d+)\)/,m=[{regex:/Syntax error in part (.+)$/,translate:(e,r)=>e.formatMessage({id:"mathParseHelpers.syntax.error",defaultMessage:"Syntax error in part {token}"},{token:r})},{regex:/End of (?:matrix|string) ([\]\"\']) expected/,translate:(e,r)=>e.formatMessage({id:"mathParseHelpers.tokenExpected.error",defaultMessage:"{token} expected"},{token:r})},{regex:/Parenthesis ([\)\]]) expected/,translate:(e,r)=>e.formatMessage({id:"mathParseHelpers.tokenExpected.error",defaultMessage:"{token} expected"},{token:r})},{regex:/Unexpected (?:operator|part) (.+)$/,translate:(e,r)=>e.formatMessage({id:"mathParseHelpers.unexpected.error",defaultMessage:"Unexpected {token}"},{token:r})}];const c=o.U(s.$);function d(e){const{str:r,property:t,schema:n,intl:a,propertyTypeDisplayName:o}=e;if(""===r.trim())return;let s;try{s=c.parse(r)}catch(p){const{message:e}=(0,i.tg)(p);return{type:"error",message:function(e,r){const t=f.exec(r);if(!t)return r;let n=t[1];const a=t[2],o=a?e.formatMessage({id:"mathParseHelpers.errorPosition.message",defaultMessage:"char {position}",description:"The character position at which an error occurred"},{position:a}):"";return m.forEach((r=>{let{regex:t,translate:a}=r;if(n.match(t)){const r=t.exec(n);if(r){const t=r[1];n=a(e,t)}}})),e.formatMessage({id:"mathParseHelpers.fullError.message",defaultMessage:"{errorBody} ({postfix})",description:"The full error message from the math.parse library. Postfix describes the position: i.e. (char 42)"},{errorBody:n,postfix:o})}(a,e),size:1}}return y(a,s,t,n,o)}function y(e,r,t,n,o){if(r){if("AccessorNode"===r.type||"ArrayNode"===r.type||"AssignmentNode"===r.type||"BlockNode"===r.type||"FunctionAssignmentNode"===r.type||"IndexNode"===r.type||"ObjectNode"===r.type||"RangeNode"===r.type)return{type:"error",size:1,message:e.formatMessage({id:"formulaHelpers.error.invalidSyntax",defaultMessage:"Invalid syntax: {input}",description:"When a user enters an invalid formula that is structured incorrectly, we show this error message."},{input:r.toString()})};if("ConditionalNode"===r.type){const a=y(e,r.condition,t,n,o),s=y(e,r.trueExpr,t,n,o),i=y(e,r.falseExpr,t,n,o);if(!a)return;if("error"===a.type)return a;if(s&&"error"===s.type)return s;if(i&&"error"===i.type)return i;if(s&&i)return s.result_type!==i.result_type?{type:"error",size:1,message:e.formatMessage({id:"formulaHelpers.error.branchCondition",defaultMessage:"Each branch of a condition must be of the same type: {input}",description:"When a user enters an invalid formula with an invalid if statement, we show this error message."},{input:r.toString()})}:{type:"conditional",result_type:s.result_type,condition:a,true:s,false:i}}else{if("ConstantNode"===r.type){const{value:t}=r,n=typeof t,a={string:"text",number:"number",boolean:"checkbox"};return n in a?{type:"constant",result_type:a[n],value:t,value_type:n}:{type:"error",size:1,message:e.formatMessage({id:"formulaHelpers.error.illegalConstant",defaultMessage:"Illegal constant: {value}",description:"When a user enters an invalid formula with an invalid constant, we show this error message."},{value:t})}}if("FunctionNode"===r.type){const{fn:s,args:i}=r;if("prop"===s.name){if(1!==i.length)return{type:"error",size:1,message:e.formatMessage({id:"formulaHelpers.error.tooManyArgumentsInProp",defaultMessage:"Too many arguments passed to prop()."})};const r=i[0];if("ConstantNode"!==r.type)return{type:"error",size:1,message:e.formatMessage({id:"formulaHelpers.error.invalidPropertyReference",defaultMessage:"Invalid property reference: {input}"},{input:r.toString()})};const a=r.value,o=Object.keys(n).find((e=>{const r=n[e];return Boolean(r&&r.name===a)})),s=o&&n[o];if(!o||!s)return{type:"error",size:1,message:e.formatMessage({id:"formulaHelpers.error.propertyNotFound",defaultMessage:"Property not found: prop({input})"},{input:a})};if("formula"===s.type){const{formula:r}=s;if(!r||!r.result_type)return;return(0,p.pV)(r).includes(t)?{type:"error",size:1,message:e.formatMessage({id:"formulaHelpers.error.circularDependency",defaultMessage:"Property {propertySchemaName} creates a circular dependency."},{propertySchemaName:s.name})}:{type:"property",result_type:(0,p.z6)(s),name:a,id:o}}return{type:"property",result_type:(0,p.z6)(s),name:a,id:o}}const l=u.uf(s.name)||u.aV(s.name);if(!l)return{type:"error",size:1,message:e.formatMessage({id:"formulaHelpers.error.undefinedFunction",defaultMessage:"Undefined function: {functionName}",description:"When a user enters an invalid formula with a function that doesn't exist, we show this error message."},{functionName:s.name})};const f=a().compact((i||[]).map((r=>y(e,r,t,n,o)))),m=g({intl:e,functionName:s.name,functionArgs:f,signatures:l.signatures,schema:n,propertyTypeDisplayName:o});if(m.error)return m.error;return{type:"function",result_type:m.value.resultType,name:s.name,args:f}}if("OperatorNode"===r.type){const{op:s,fn:i,args:p}=r,l=u.aV(i);if(!l)return{type:"error",size:1,message:e.formatMessage({id:"formulaHelpers.error.undefinedOperator",defaultMessage:"Undefined operator: {operator}",description:"When a user enters an invalid formula with an operator that doesn't exist, we show this error message."},{operator:s})};const f=a().compact((p||[]).map((r=>y(e,r,t,n,o)))),m=g({intl:e,functionName:i,functionArgs:f,signatures:l.signatures,schema:n,propertyTypeDisplayName:o});if(m.error)return m.error;return{type:"operator",result_type:m.value.resultType,operator:s,name:i,args:f}}if("ParenthesisNode"===r.type)return y(e,r.content,t,n,o);if("SymbolNode"===r.type){const{name:t}=r;return t in u._G?{type:"symbol",result_type:u._G[t].resultType,name:t}:{type:"error",size:1,message:e.formatMessage({id:"formulaHelpers.error.undefinedConstant",defaultMessage:"Undefined constant: {constantName}",description:"When a user enters an invalid formula with a constant that doesn't exist, we show this error message."},{constantName:t})}}}}}function g(e){const{intl:r,functionName:t,functionArgs:n,signatures:o,schema:s,propertyTypeDisplayName:i}=e;return o.reduce(((e,o)=>{if(!e.error)return e;const p=function(e){const{intl:r,functionName:t,functionArgs:n,signature:o,schema:s,propertyTypeDisplayName:i}=e,{arity:p,variadic:u}=o;if(u){if(!(n.length>0))return{type:"error",size:1,message:r.formatMessage({id:"formulaHelpers.error.tooFewArgumentsVariadic",defaultMessage:"Too few arguments in function {functionName}",description:"When a user enters an invalid formula with an improper use of the function, we show this error message."},{functionName:t})};{const e=a().compact(n.map((e=>h({intl:r,resultType:u,functionArg:e,schema:s,propertyTypeDisplayName:i}))));if(e.length>0)return{...e[0],size:e.length}}}if(p){if(n.length<p.length)return{type:"error",size:1,message:r.formatMessage({id:"formulaHelpers.error.tooFewArguments",defaultMessage:"Too few arguments in function {functionName}",description:"When a user enters an invalid formula with an improper use of the function, we show this error message."},{functionName:t})};if(n.length>p.length)return{type:"error",size:1,message:r.formatMessage({id:"formulaHelpers.error.tooManyArguments",defaultMessage:"Too many arguments in function {functionName}",description:"When a user enters an invalid formula with an improper use of the function, we show this error message."},{functionName:t})};const e=a().compact(n.map(((e,t)=>h({intl:r,resultType:p[t],functionArg:e,schema:s,propertyTypeDisplayName:i}))));if(e.length>0)return{...e[0],size:e.length}}}({intl:r,functionName:t,functionArgs:n,signature:o,schema:s,propertyTypeDisplayName:i});return p?e.error.size<p.size?e:{error:p}:{value:o}}),{error:{type:"error",size:99,message:r.formatMessage({id:"formulaHelpers.error.noSignatureForFunction",defaultMessage:"No signatures found for function: {functionName}",description:"When a user enters an invalid formula with a function that doesn't exist, we show this error message."},{functionName:t})}})}function h(e){const{intl:r,resultType:t,functionArg:n,schema:a,propertyTypeDisplayName:o}=e;if("error"===n.type)return n;if(t!==n.result_type){const e=(0,l.formulaToString)(n,a);return{type:"error",size:1,message:r.formatMessage({id:"formulaHelpers.error.typeMismatch",defaultMessage:"Type mismatch {nodeString} is not a {localizedPropertyTypeDisplayName}.",description:"When tye types in the function don't match the database property type, we show this error."},{nodeString:e,localizedPropertyTypeDisplayName:t?o[t]:r.formatMessage({id:"formatMessage.error.undefinedResultType",defaultMessage:"undefined"})})}}}},75042:()=>{}}]);