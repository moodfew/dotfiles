"use strict";(self.webpackChunknotion_next=self.webpackChunknotion_next||[]).push([[471],{8522:(e,t,i)=>{i.r(t),i.d(t,{default:()=>ze});var o=i(77422),r=i.n(o),s=i(77094),a=i.n(s),n=(i(33948),i(96486)),d=i.n(n),h=i(67294),l=i.n(h),c=i(83355),u=i(40902),p=i(66897),g=i(17215),m=i(41432),v=i(8848),f=i(39068),S=i(55061),y=i(98459),b=i(89101),A=i(58129),_=i(21202),k=i(77420),w=i(6287),T=i(13493),J=i(70279),M=i(33709),B=i(57883),O=i(84683),D=i(75246),I=i(29369),C=i(19889),R=i(94044),P=i(99108),N=i(70203),V=i(97880),Z=i(82990),F=i(63143),L=i(5366),x=i(50906),U=i(17659),E=i(9953),q=i(4083),G=i(38363),K=i(93561),W=i(14976),z=i(52821),H=i(17731),j=i(81997),$=i(67669),Y=i(9714),X=i(55277),Q=i(90031),ee=i(64442),te=i(29716),ie=i(62820),oe=i(4761),re=i(38978),se=i(97464),ae=i.n(se),ne=i(3779),de=i(51118),he=i(43250),le=i(33929),ce=i(16402),ue=i(12318),pe=i(14947),ge=i(80527),me=i(67706),ve=i(32469),fe=i(8934),Se=i(37235),ye=i(49481),be=i(64581);class Ae extends c.Z{constructor(){super(...arguments),r()(this,"storeTypes",{hovered:ue.Z.of(!1)}),r()(this,"handleMouseMove",(()=>{this.stores.hovered.set(!0)})),r()(this,"handleMouseLeave",(()=>{this.stores.hovered.set(!1)})),r()(this,"handleArchive",(()=>{const{notification:e,rootStore:t}=this.props;e&&K.createAndCommit({userAction:"ActivitySection.handleArchive",environment:this.environment,perform:i=>{U.aZ({notification:e,rootStore:t,transaction:i})}})})),r()(this,"handleOpenSnapshot",(()=>{if(this.props.navigableBlockId){const e=Y.Z.createChildStore(this.props.rootStore,{table:_.iU,id:this.props.navigableBlockId});de.jN({environment:this.environment,blockStore:e,openSnapshotNearTimestamp:this.props.timestamp.toString(),from:"activity"})}}))}renderComponent(){const{children:e}=this.props;return a()("div",{onMouseMove:this.handleMouseMove,onMouseLeave:this.handleMouseLeave},void 0,a()("div",{style:{...Ae.wrapStyle,paddingBottom:e?12:8,paddingLeft:this.environment.device.isMobile?this.environment.WindowSizeStore.state.paddingLeftCSS:0,paddingRight:this.environment.device.isMobile?this.environment.WindowSizeStore.state.paddingRightCSS:0}},void 0,a()("div",{style:this.getHeaderAndAvatarStyle()},void 0,a()("div",{className:he.Fo},void 0,this.props.icon),this.renderHeader(),this.renderSnapshotButton(),this.renderArchiveAction(),this.renderPrivate()),e&&this.renderChildren()),this.renderDivider())}renderDivider(){const{isLast:e}=this.props;if(!e)return a()("div",{style:this.getBorderBottomStyle()})}renderHeader(){const{timestamp:e,header:t}=this.props,i=(0,ce.IS)(e),o=(0,ce.uy)(e);return a()("div",{style:Ae.headerStyle},void 0,a()("div",{className:he.NF},void 0,t),a()("div",{style:{display:"flex",marginTop:4,marginBottom:this.props.children?8:4}},void 0,a()("div",{style:this.getTimeStyle(),className:he.CZ},void 0,a()(me.Z,{text:i,tooltipText:o,icon:ne.Z.calendar})),this.props.navigableBlockId&&this.props.rootStore&&a()(fe.Z,{isLink:!0,innerStyle:this.getPathStyle(),store:Y.Z.createChildStore(this.props.rootStore,{table:_.iU,id:this.props.navigableBlockId}),left:a()("div",{style:this.getSeparatorDotStyle()},void 0,"·")})))}renderSnapshotButton(){if(this.props.showSnapshotButton&&!(this.props.timestamp<new Date("2018-10-26").getTime()))return this.props.navigableBlockId?a()(Se.Z,{renderTooltip:()=>a()(L.FormattedMessage,{defaultMessage:"View version for this update",id:"activitySection.viewVersionForUpdate.tooltip"}),render:e=>l().createElement(ge.Z,ae()({onClick:this.handleOpenSnapshot,icon:ne.Z.versionHistoryThick},e))}):void 0}renderArchiveAction(){const{notification:e}=this.props,{device:t}=this.environment,{currentTab:i}=oe.Z.state;if("mentions"===i&&e&&!e.visited)return a()(Se.Z,{renderTooltip:()=>a()(L.FormattedMessage,{defaultMessage:"Archive this notification",id:"activitySection.archiveAction.tooltip"}),render:e=>l().createElement("div",ae()({style:{...Ae.statusLabelContainerStyle,position:"relative",marginLeft:this.environment.device.isMobile?23:8}},e),!this.isSeen()&&a()("div",{style:{...Ae.statusDotStyle,opacity:this.stores.hovered.get()?0:1,right:this.environment.device.isMobile?28:2.5,top:this.environment.device.isMobile?7.5:5.5}}),a()(pe.Z,{onClick:this.handleArchive,style:{display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"100%",background:this.theme.buttonHoveredBackground,width:t.isMobile?24:20,height:t.isMobile?24:20,opacity:this.environment.device.isMobile||this.stores.hovered.get()?1:0},hoveredStyle:{background:this.theme.buttonPressedBackground}},void 0,ne.Z.closeSmall({width:t.isMobile?18:14,fill:this.theme.mediumTextColor})))})}renderPrivate(){if(this.props.isPrivate&&!this.props.notification)return a()(ve.Z,{style:{marginTop:1,marginBottom:4,marginLeft:8}})}renderChildren(){return a()("div",{className:he.nU},void 0,this.props.children)}isSeen(){const{notification:e}=this.props;return!e||e.read}getHeaderAndAvatarStyle(){return{display:"flex",paddingLeft:16,paddingRight:16}}getBorderBottomStyle(){return{borderBottom:"1px solid ".concat(this.theme.regularDividerColor)}}getPathStyle(){return{fontSize:12,color:this.theme.lightTextColor}}getTimeStyle(){return{fontSize:12,color:this.theme.lightTextColor,whiteSpace:"nowrap"}}getSeparatorDotStyle(){return{fontSize:12,color:this.theme.lightTextColor,marginLeft:4,marginRight:4}}}r()(Ae,"wrapStyle",{paddingTop:12}),r()(Ae,"headerStyle",{fontSize:14,lineHeight:1.4,flexGrow:1,minWidth:0}),r()(Ae,"statusLabelContainerStyle",{display:"flex",alignItems:"flex-start",marginTop:1,marginBottom:4}),r()(Ae,"statusDotStyle",{height:8,width:8,flexShrink:0,marginRight:4,background:v.ZP.blue,borderRadius:"100%",position:"absolute",pointerEvents:"none"});const _e={fontWeight:Z.Z.fontWeight.semibold},ke={marginTop:2,marginRight:8,flexShrink:0};function we(e){const{authors:t}=e,i=t[0];return i&&(0,p.z8)(i)?a()(ye.Z,{botValue:i.value}):a()(be.Z,{userValue:i&&i.value,style:ke,size:28,avatarShouldShowShadow:!0})}function Te(){return a()("div",{style:{display:"flex",backgroundColor:v.ZP.red,height:28,width:28,borderRadius:"100%",...ke}},void 0,ne.Z.alarmClock({height:16,width:16,fill:v.ZP.white,marginLeft:6,marginTop:5}))}function Je(e){const t=e.map((e=>(0,p.$4)(le.default.getIntl(),e)));if(1===t.length)return a()("span",{},void 0,a()(L.FormattedMessage,{defaultMessage:"<b>{author}</b>",id:"activitySection.authorPhrase.forOneAuthor.label",values:{author:t[0],b:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return a()("span",{style:_e},void 0,t)}}}));if(2===t.length)return a()("span",{},void 0,a()(L.FormattedMessage,{defaultMessage:"<b>{firstAuthor}</b> and <b>{secondAuthor}</b>",id:"activitySection.authorPhrase.forTwoAuthors.label",values:{firstAuthor:t[0],secondAuthor:t[1],b:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return a()("span",{style:_e},void 0,t)}}}));if(t.length>2){const e=a()(L.FormattedMessage,{defaultMessage:"{numberOfOtherAuthors, plural, one {<b>{firstAuthor}</b>, <b>{secondAuthor}</b>, and {numberOfOtherAuthors} other} other {<b>{firstAuthor}</b>, <b>{secondAuthor}</b>, and {numberOfOtherAuthors} others}}",id:"activitySection.authorPhrase.forMoreThanTwoAuthors.label",values:{numberOfOtherAuthors:t.length-2,firstAuthor:t[0],secondAuthor:t[1],b:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return a()("span",{style:_e},void 0,t)}}});return a()("span",{},void 0,e)}return a()("span",{style:_e},void 0,a()(L.FormattedMessage,{defaultMessage:"Nobody",id:"activitySection.authorPhrase.forNoAuthors.label"}))}const Me=Ae;var Be=i(45669),Oe=i(79931),De=i(27006),Ie=i(76464),Ce=i(17256),Re=i(1643),Pe=i(78291),Ne=i(7567),Ve=i(33058),Ze=i(46951);class Fe extends c.Z{constructor(){super(...arguments),r()(this,"storeTypes",{role:ue.Z.of(void 0)}),r()(this,"handleGrantAccess",(async()=>{const{targetBlockStore:e,accessRequestStore:t}=this.props,i=this.getInviteTargetWithNewPermissionItem();if(!("permissionItem"in i))return;const o=this.environment.currentUser.id;if(!o)return;if("type"in i){let t;if("existingUser"===i.type){t=(await Ie.n_({environment:this.environment,store:e,inviteTargets:[i],inviteRole:i.permissionItem.role,isOnboarding:!1,invite:{inviteOrigin:"page_request_access"}})).success}else if("bot"===i.type){t=(await Ie.n_({environment:this.environment,store:e,inviteTargets:[i],inviteRole:void 0,isOnboarding:!1,invite:{inviteOrigin:"page_request_access"}})).success}else(0,V.t1)(i);if(!t)return}K.createAndCommit({userAction:"GrantAccessActivityAction.handleGrantAccess",environment:this.environment,perform:r=>{"type"in i||Ie.ep({environment:this.environment,transaction:r,store:e,permissionItems:[i.permissionItem]}),E.sW({store:t,transaction:r,data:{granted_time:Date.now(),granted_by_table:C.KJ,granted_by_id:o}})}});const r=t.getValue(),s=r&&r.created_time&&r.granted_time?r.granted_time-r.created_time:void 0;x.nCD(this.environment,{requestId:r&&r.id,timeElapsedSinceRequest:s})})),r()(this,"handleRoleChange",(e=>this.stores.role.setState(e))),r()(this,"handleArchive",(()=>{const{notification:e}=this.props;e&&(K.createAndCommit({userAction:"GrantAccessActivityAction.handleArchive",environment:this.environment,perform:t=>{(0,U.aZ)({notification:e,rootStore:this.props.accessRequestStore,transaction:t})}}),x.cOL(this.environment))}))}renderComponent(){const e=this.props.accessRequestStore.getValue();if(!e)return;if((0,A.Kc)(e))return this.renderGrantedAccessRequest(e);if(!this.canGrantAccess())return;const t=this.getCurrentPermissionItem();if(t){const i=this.renderActor(e.for_actor_table,e.for_actor_id),o=t.role===this.getRole();return l().createElement(l().Fragment,null,a()(Ze.Z,{isSecondaryColor:!0,style:{marginBottom:6}},void 0,a()(L.FormattedMessage,{defaultMessage:"{requestingUser} already has access.",id:"grantAccessActivityAction.alreadyHasAccess.label",description:"Shown if the user who requested access already has access",values:{requestingUser:i}})),a()(Ne.Z,{upgradeButtonName:"user_permission_item",role:this.getRole(),table:_.iU,blockType:this.props.targetBlockStore.getType(),type:e.for_actor_table===C.KJ?"user_permission":"bot_permission",onChange:this.handleRoleChange,isInvite:!0,buttonStyle:this.getButtonStyle(!0)}),a()(Ve.Z,{onClick:this.handleGrantAccess,style:this.getButtonStyle(o)},void 0,a()(L.FormattedMessage,{defaultMessage:"Change",id:"grantAccessActivityAction.changePermissionButton.label"})),this.renderArchiveButton())}return l().createElement(l().Fragment,null,a()(Ne.Z,{upgradeButtonName:"user_permission_item",role:this.getRole(),table:_.iU,blockType:this.props.targetBlockStore.getType(),type:e.for_actor_table===C.KJ?"user_permission":"bot_permission",onChange:this.handleRoleChange,isInvite:!0,buttonStyle:this.getButtonStyle(!1)}),a()(Ve.Z,{onClick:this.handleGrantAccess,style:this.getButtonStyle(!1)},void 0,a()(L.FormattedMessage,{defaultMessage:"Grant access",id:"grantAccessActivityAction.grantAccessButton.label"})),this.renderArchiveButton())}renderGrantedAccessRequest(e){const t=this.renderActor(e.granted_by_table,e.granted_by_id),i=(0,Ce.Z)(Math.min(e.granted_time,Date.now())).calendar();return l().createElement(l().Fragment,null,a()(Ze.Z,{isSecondaryColor:!0},void 0,a()(L.FormattedMessage,{defaultMessage:"Approved by {grantedBy}",id:"grantAccessActivityAction.accessGranted.title",values:{grantedBy:t,time:i}})),a()(Ze.Z,{isSmall:!0,isSecondaryColor:!0},void 0,i))}renderArchiveButton(){const{notification:e}=this.props;if(e&&!e.visited)return a()(Ve.Z,{onClick:this.handleArchive,style:{height:26,paddingLeft:8,paddingRight:8}},void 0,a()(L.FormattedMessage,{defaultMessage:"Ignore",id:"grantAccessActivityAction.ignoreButton.label"}))}getRole(){const e=this.getCurrentPermissionItem(),t=e&&e.role;return this.stores.role.state||t||this.props.initialRole}getNewPermissionItem(){const e=this.props.accessRequestStore.getValue();if(e)return e.for_actor_table===C.KJ?{type:"user_permission",user_id:e.for_actor_id,role:this.getRole()}:{type:"bot_permission",bot_id:e.for_actor_id,role:this.getRole()}}getInviteTargetWithNewPermissionItem(){const e=this.getNewPermissionItem();if(!e)return{};if(this.getCurrentPermissionItem())return{permissionItem:e};const{data:t}=Pe.default.state;if("user_permission"===e.type){const i=this.rootStore.getRecordValue({table:C.KJ,id:e.user_id}),o=t?Re.uF(t):[],r=o&&o.some((t=>t.userId===e.user_id));return i&&!r?{type:"existingUser",value:i,permissionItem:e}:{permissionItem:e}}if("bot_permission"===e.type){const i=this.rootStore.getRecordValue({table:k.cZ,id:e.bot_id}),o=(t?Re.NM(t):[]).some((t=>t.botId===e.bot_id));return i&&!o?{type:"bot",value:i,permissionItem:e}:{permissionItem:e}}(0,V.t1)(e)}getCurrentPermissionItem(){const e=this.props.accessRequestStore.getValue();if(!e)return;const t=this.props.targetBlockStore.getPermissionItems();for(const i of t){if(e.for_actor_table===C.KJ&&(0,De.jg)(i)&&i.user_id===e.for_actor_id)return i;if(e.for_actor_table===k.cZ&&(0,De.FB)(i)&&i.bot_id===e.for_actor_id)return i}}canGrantAccess(){return this.props.targetBlockStore.canAdmin()}renderActor(e,t){return Je(d().compact([this.getActor(e,t)]))}getActor(e,t){if(e===C.KJ){const i=this.rootStore.getRecordValue({table:e,id:t});if(i)return(0,p.dp)(i)}if(e===k.cZ){const i=this.rootStore.getRecordValue({table:e,id:t});if(i)return(0,p.D$)(i)}}get rootStore(){return this.props.accessRequestStore}getButtonStyle(e){const t={height:26,paddingLeft:8,paddingRight:8,boxShadow:this.theme.plainButtonBoxShadow,fontSize:12,marginRight:10};return e?t:{...t,color:this.theme.regularTextColor,fontWeight:500}}}const Le=Fe;var xe=i(28240),Ue=i(40039),Ee=i(79029);class qe extends c.Z{constructor(){super(...arguments),r()(this,"storeTypes",{open:ue.Z.of(!1)}),r()(this,"handleOpen",(()=>{this.stores.open.set(!0)}))}renderComponent(){return this.stores.open.get()||this.props.items.length<=this.props.visible?a()("div",{},void 0,this.props.items):a()("div",{},void 0,this.props.items.slice(0,this.props.visible),a()(pe.Z,{onClick:this.handleOpen,style:this.getStyle()},void 0,a()(L.FormattedMessage,{defaultMessage:"View {moreCount} more",id:"activity.viewMoreButton.label",values:{moreCount:this.props.items.length-this.props.visible}})))}getStyle(){return{display:"flex",alignItems:"center",height:28,fontSize:12,color:this.theme.lightTextColor,padding:0,paddingLeft:52,paddingRight:16}}}const Ge=qe,Ke=a()("div",{style:{width:5,display:"inline-block"}});class We extends c.Z{constructor(){super(...arguments),r()(this,"renderBlockEdit",((e,t,i)=>{let o=this.getRecordValue({table:_.iU,id:e.block_id});o&&o.type===m.ZP.tableRow&&(o=this.getRecordValue({table:_.iU,id:o.parent_id}));const r=o?(0,g.Om)({table:"block",value:o,getRecordValue:this.getRecordValue}):b._j.root;return"block-deleted"===e.type?e.block_data.block_value.type===m.ZP.page?a()(xe.Z,{href:r,onClick:()=>this.track("block_edit"),innerStyle:We.editButtonStyle},t,a()(Oe.Z,{edit:e,rootStore:this.props.rootStore})):a()("div",{style:We.editButtonStyle},t,a()(Oe.Z,{edit:e,rootStore:this.props.rootStore})):a()(xe.Z,{href:r,onClick:()=>this.track("block_edit"),innerStyle:We.editButtonStyle},t,a()(Oe.Z,{edit:e,rootStore:this.props.rootStore}))})),r()(this,"handleUnfollow",(()=>this.setFollowing(!1))),r()(this,"handleFollow",(()=>this.setFollowing(!0))),r()(this,"handleUnarchive",(()=>{const{notification:e,rootStore:t}=this.props;e&&K.createAndCommit({userAction:"Activity.handleUnarchive",environment:this.environment,perform:i=>{U.E1({notificationId:e.id,visited:!1,rootStore:t,transaction:i})}})})),r()(this,"getUserValue",(e=>re.Z.createChildStore(this.props.rootStore,{table:C.KJ,id:e}).getValue())),r()(this,"getBotValue",(e=>(0,Q.Kv)(this.props.rootStore,{table:k.cZ,id:e}).getValue())),r()(this,"getAuthorActor",(e=>{if(e.table===C.KJ){const t=this.getUserValue(e.id);if(t)return(0,p.dp)(t)}else{const t=this.getBotValue(e.id);if(t)return(0,p.D$)(t)}})),r()(this,"getSpaceValue",(e=>ee.Z.createChildStore(this.props.rootStore,{table:D.bx,id:e}).getValue())),r()(this,"getTeamValue",(e=>te.Z.createChildStore(this.props.rootStore,{table:I.e0,id:e}).getValue())),r()(this,"getDiscussionContextAndId",(()=>{const{activity:e}=this.props;if("commented"!==e.type)return;const t=this.getRecordValue({table:M.qF,id:e.discussion_id,spaceId:e.space_id});if(!t)return;if(!t.context)return;const i=(0,N.VP)(t.context,(e=>!(0,N.xw)(e)||(0,N.h1)(e)===t.id));return{id:t.id,context:i}})),r()(this,"getDiscussionContext",(()=>{const e=this.getDiscussionContextAndId();if(e)return e.context}))}willMountOrUpdate(){this.warmCommentData(),this.environment.KatexStore.loadIfNeeded(this.getDiscussionContext)}warmCommentData(){if("commented"===this.props.activity.type){const e=(0,Q.Kv)(this.props.rootStore,{table:M.qF,id:this.props.activity.discussion_id,spaceId:this.props.activity.space_id}).getValue();if(e){const t=e.comments||[];for(const e of t){const t=(0,Q.Kv)(this.props.rootStore,{table:J.x_,id:e,spaceId:this.props.activity.space_id}).getValue();if(t&&t.created_by_table&&t.created_by_id){(0,Q.Kv)(this.props.rootStore,{table:t.created_by_table,id:t.created_by_id}).getValue()}}}}}renderComponent(){const{activity:e}=this.props;switch(e.type){case"block-edited":return this.renderBlockEditActivity(e);case"collection-row-created":case"collection-row-deleted":return this.renderCollectionRowActivity(e);case"top-level-block-created":case"top-level-block-deleted":return this.renderTopLevelBlockActivity(e);case"permissions-edited":return this.renderPermissionsActivity(e);case"permission-group-edited":return this.renderPermissionGroupActivity(e);case"user-mentioned":return this.renderMentionActivity(e);case"commented":return this.renderCommentActivity(e);case"user-invited":return this.renderUserInvitedActivity(e);case"collection-edited":return this.renderCollectionEdited(e);case"collection-view-edited":return this.renderCollectionViewEdited(e);case"collection-property-edited":return this.renderCollectionPropertyEdited(e);case"reminder":return this.renderReminderActivity(e);case"page-locked":case"page-unlocked":return this.renderPageLockActivity(e);case"email-edited":return this.renderEmailEdited(e);case"access-requested":return this.renderAccessRequested(e);case"page-deleted":case"page-restored":case"page-permanently-deleted":return this.renderPageDeleteOrRestoreActivity(e);case"team-membership-edited":return this.renderTeamMembershipEditedActivity(e);default:(0,V.t1)(e)}}renderBlockEditActivity(e){if(!e.edits)return;const t=(0,P.hI)(e.edits).filter((e=>{const{block_value:t}="block-changed"===e.type?e.block_data.after:e.block_data;return t.parent_table!==J.x_}));if(0===t.length)return;const i=this.getBlockValue(t[0].navigable_block_id);if(!i)return;const o=this.getAuthors(t),r=Je(o),s=this.renderTitle("block",i);return a()(Me,{timestamp:parseInt(e.end_time),header:a()("span",{},void 0,a()(L.FormattedMessage,{defaultMessage:"{authorOrAuthors} edited {pageTitle}",id:"activity.blockEdited.header",description:"Notification header for updates. The authorOrAuthors variable will be either a name (eg John Doe), two names (eg John Doe and Jane Smith), or more than three (eg John Doe, Jane Smith, and 3 others)",values:{authorOrAuthors:r,pageTitle:s}})),isLast:this.props.isLast,isPrivate:this.getIsRecordPrivateToUser(i.id,"block"),rootStore:this.props.rootStore,navigableBlockId:i.id,notification:this.props.notification,icon:a()(we,{authors:o}),showSnapshotButton:this.props.isTopbarUpdatesMenu},void 0,a()(Ge,{visible:5,items:t.map(this.renderBlockEdit)}),this.renderNotificationActions())}renderCollectionRowActivity(e){if(!e.edits)return;const t=e.edits[0],i=this.getBlockValue(e.collection_row_id);if(!i)return;if(!i.properties)return;const o=this.getAuthors(e.edits),r=Je(o),s=this.renderTitle("block",i),n="collection-row-created"===t.type?a()(L.FormattedMessage,{defaultMessage:"{authorOrAuthors} created {pageTitle}",values:{authorOrAuthors:r,pageTitle:s},id:"activity.collectionRowCreated.header",description:"Notification header for updates. The authorOrAuthors variable will be either a name (eg John Doe), two names (eg John Doe and Jane Smith), or more than three (eg John Doe, Jane Smith, and 3 others)"}):a()(L.FormattedMessage,{defaultMessage:"{authorOrAuthors} deleted {pageTitle}",values:{authorOrAuthors:r,pageTitle:s},id:"activity.collectionRowDeleted.header",description:"Notification header for updates. The authorOrAuthors variable will be either a name (eg John Doe), two names (eg John Doe and Jane Smith), or more than three (eg John Doe, Jane Smith, and 3 others)"});return a()(Me,{timestamp:parseInt(e.end_time),header:a()("span",{},void 0,n),isLast:this.props.isLast,isPrivate:this.getIsRecordPrivateToUser(i.id,"block"),rootStore:this.props.rootStore,navigableBlockId:i.id,notification:this.props.notification,icon:a()(we,{authors:o}),showSnapshotButton:this.props.isTopbarUpdatesMenu},void 0,this.renderNotificationActions())}renderTopLevelBlockActivity(e){if(!e.edits)return;const t=e.edits[0],i=this.getBlockStore(e.top_level_block_id),o=i.getValue();if(!o)return;const r=i.hasSpacePermission(),s=this.getAuthors(e.edits),n=Je(s),d=this.renderTitle("block",o);let h;return h=r?"top-level-block-created"===t.type?a()(L.FormattedMessage,{defaultMessage:"{authorOrAuthors} created workspace page {pageTitle}",values:{authorOrAuthors:n,pageTitle:d},id:"activity.topLevelBlockWorkspaceCreated.header",description:"Notification header for updates. The authorOrAuthors variable will be either a name (eg John Doe), two names (eg John Doe and Jane Smith), or more than three (eg John Doe, Jane Smith, and 3 others)"}):a()(L.FormattedMessage,{defaultMessage:"{authorOrAuthors} deleted workspace page {pageTitle}",values:{authorOrAuthors:n,pageTitle:d},id:"activity.topLevelBlockWorkspaceDeleted.header",description:"Notification header for updates. The authorOrAuthors variable will be either a name (eg John Doe), two names (eg John Doe and Jane Smith), or more than three (eg John Doe, Jane Smith, and 3 others)"}):"top-level-block-created"===t.type?a()(L.FormattedMessage,{defaultMessage:"{authorOrAuthors} created private page {pageTitle}",values:{authorOrAuthors:n,pageTitle:d},id:"activity.topLevelBlockPrivateCreated.header",description:"Notification header for updates. The authorOrAuthors variable will be either a name (eg John Doe), two names (eg John Doe and Jane Smith), or more than three (eg John Doe, Jane Smith, and 3 others)"}):a()(L.FormattedMessage,{defaultMessage:"{authorOrAuthors} deleted private page {pageTitle}",values:{authorOrAuthors:n,pageTitle:d},id:"activity.topLevelBlockPrivateDeleted.header",description:"Notification header for updates. The authorOrAuthors variable will be either a name (eg John Doe), two names (eg John Doe and Jane Smith), or more than three (eg John Doe, Jane Smith, and 3 others)"}),a()(Me,{timestamp:parseInt(e.end_time),header:a()("span",{},void 0,h),isLast:this.props.isLast,isPrivate:this.getIsRecordPrivateToUser(o.id,"block"),rootStore:this.props.rootStore,notification:this.props.notification,icon:a()(we,{authors:s}),showSnapshotButton:!1})}renderPermissionsActivity(e){if(!e.edits)return;const t=(0,P.hI)(e.edits);if(0===t.length)return;let i,o;const r=t[0];if(r.navigable_block_id){const e=this.getBlockValue(r.navigable_block_id);if(!e)return;o=this.renderTitle("block",e),i=this.getIsRecordPrivateToUser(e.id,"block")}else{const e=this.getSpaceValue(r.space_id);if(!e)return;o=this.renderTitle("space",e),i=this.getIsRecordPrivateToUser(r.space_id,"space")}const{autojoinEdits:s,inheritanceEdits:n,otherEdits:d}=u.md(e.edits),h=[];if(s.forEach(((e,t)=>{const r=this.getAuthors([e]),s=Je(r);h.push(a()(Me,{timestamp:e.timestamp,header:a()("span",{},void 0,a()(L.FormattedMessage,{defaultMessage:"{authorOrAuthors} joined {pageOrSpaceName}",values:{authorOrAuthors:s,pageOrSpaceName:o},id:"activity.permissionsActivity.header",description:"Notification header for updates. The authorOrAuthors variable will be either a name (eg John Doe), two names (eg John Doe and Jane Smith), or more than three (eg John Doe, Jane Smith, and 3 others)"})),isLast:this.props.isLast,isPrivate:i,rootStore:this.props.rootStore,navigableBlockId:e.navigable_block_id,notification:this.props.notification,icon:a()(we,{authors:r}),showSnapshotButton:!1},"autojoin-".concat(t)))})),n.forEach(((t,r)=>{const s=this.getAuthors([t]),n=Je(s);let d;"permission-restriction-created"===t.type?d=a()(L.FormattedMessage,{defaultMessage:"{authorOrAuthors} restricted access for {pageOrSpaceName}",values:{authorOrAuthors:n,pageOrSpaceName:o},id:"activity.restrictPermissionsForActivity.header",description:"Notification header for updates. The authorOrAuthors variable will be either a name (eg John Doe), two names (eg John Doe and Jane Smith), or more than three (eg John Doe, Jane Smith, and 3 others)"}):"permission-restriction-deleted"===t.type&&(d=a()(L.FormattedMessage,{defaultMessage:"{authorOrAuthors} restored inherited access for {pageOrSpaceName}",values:{authorOrAuthors:n,pageOrSpaceName:o},id:"activity.restorePermissionsForActivity.header",description:"Notification header for updates. The authorOrAuthors variable will be either a name (eg John Doe), two names (eg John Doe and Jane Smith), or more than three (eg John Doe, Jane Smith, and 3 others)"})),h.push(a()(Me,{timestamp:parseInt(e.end_time),header:a()("span",{},void 0,d),isLast:this.props.isLast,isPrivate:i,rootStore:this.props.rootStore,navigableBlockId:t.navigable_block_id,notification:this.props.notification,icon:a()(we,{authors:s}),showSnapshotButton:!1},"inheritance-".concat(r),a()("div",{style:We.editButtonStyle},void 0,a()(Oe.Z,{edit:t,rootStore:this.props.rootStore})),this.renderNotificationActions()))})),d.length>0){const t=this.getAuthors(d),s=Je(t);h.push(a()(Me,{timestamp:parseInt(e.end_time),header:a()("span",{},void 0,a()(L.FormattedMessage,{defaultMessage:"{authorOrAuthors} updated permission for {pageOrSpaceName}",values:{authorOrAuthors:s,pageOrSpaceName:o},id:"activity.updatedPermissionsForActivity.header",description:"Notification header for updates. The authorOrAuthors variable will be either a name (eg John Doe), two names (eg John Doe and Jane Smith), or more than three (eg John Doe, Jane Smith, and 3 others)"})),isLast:this.props.isLast,isPrivate:i,rootStore:this.props.rootStore,navigableBlockId:r.navigable_block_id,notification:this.props.notification,icon:a()(we,{authors:t}),showSnapshotButton:!1},"others",d.map(((e,t,i)=>a()("div",{style:We.editButtonStyle},t,a()(Oe.Z,{edit:e,rootStore:this.props.rootStore},t)))),this.renderNotificationActions()))}return h}renderPermissionGroupActivity(e){if(!e.edits)return;const t=(0,P.hI)(e.edits)[0];if(!t)return;const i=this.getSpaceValue(t.space_id);if(!i)return;const o=(0,g.Om)({table:"space",value:i,getRecordValue:this.getRecordValue}),r=this.renderPermissionGroupTitle((0,S.c_)({activity:e,getRecordValue:this.getRecordValue}),e.space_id),s=this.getAuthors(e.edits);return a()(Me,{timestamp:parseInt(e.end_time),header:a()("span",{},void 0,this.renderPermissionGroupEditedHeader({activity:e,authors:s,groupName:r})),isLast:this.props.isLast,isPrivate:this.getIsRecordPrivateToUser(e.space_id,"space"),rootStore:this.props.rootStore,notification:this.props.notification,icon:a()(we,{authors:s}),showSnapshotButton:!1},void 0,a()(xe.Z,{href:o,onClick:()=>this.track("group_edit"),innerStyle:We.editButtonStyle},void 0,a()(Oe.Z,{edit:t,rootStore:this.props.rootStore})),this.renderNotificationActions())}renderMentionActivity(e){if(!e.edits)return;const t=e.edits[0],i=this.getBlockValue(t.navigable_block_id);if(!i)return;const o=this.getBlockValue(e.mentioned_block_id);if(!o)return;const r=(0,g.Om)({table:"block",value:o,getRecordValue:this.getRecordValue}),s=this.getAuthors(e.edits),n=Je(s);return a()(Me,{timestamp:parseInt(e.end_time),header:a()("span",{},void 0,a()(L.FormattedMessage,{defaultMessage:"{authorOrAuthors} mentioned you in {pageName}",values:{authorOrAuthors:n,pageName:this.renderTitle("block",i)},id:"activity.mentionActivity.header",description:"Notification header for updates. The authorOrAuthors variable will be either a name (eg John Doe), two names (eg John Doe and Jane Smith), or more than three (eg John Doe, Jane Smith, and 3 others)"})),isLast:this.props.isLast,isPrivate:this.getIsRecordPrivateToUser(i.id,"block"),rootStore:this.props.rootStore,navigableBlockId:i.id,notification:this.props.notification,icon:a()(we,{authors:s}),showSnapshotButton:!1},void 0,a()(xe.Z,{href:r,onClick:()=>this.track("mention_edit"),innerStyle:We.editButtonStyle},void 0,a()(Oe.Z,{edit:t,rootStore:this.props.rootStore})),this.renderNotificationActions())}renderCommentActivity(e){if(!e.edits)return;const t=(0,Q.Kv)(this.props.rootStore,{table:M.qF,id:e.discussion_id,spaceId:e.space_id}),i=t.getValue();if(!i)return;const o=Y.Z.createChildStore(this.props.rootStore,{table:_.iU,id:i.parent_id}),r=(0,j.qA)(o),s=(0,j.Zg)(r),n=o.getValue();if(!n)return;const d=this.getBlockValue(e.navigable_block_id);if(!d)return;const h=s?(0,g.Om)({table:"block",value:n,getRecordValue:this.getRecordValue,discussionId:e.discussion_id}):void 0,l=this.getAuthors(e.edits),c=Je(l),u=e=>{if(this.track("comment_edit"),!s){const i=e.target;(0,q.oK)({environment:this.environment,discussionStore:t,rect:i.getBoundingClientRect(),blockStore:o})}};return a()(Me,{timestamp:parseInt(e.end_time),header:a()("span",{},void 0,a()(L.FormattedMessage,{defaultMessage:"{authorOrAuthors} commented in {blockName}",values:{authorOrAuthors:c,blockName:this.renderTitle("block",d)},id:"activity.commentActivity.header",description:"Notification header for updates. The authorOrAuthors variable will be either a name (eg John Doe), two names (eg John Doe and Jane Smith), or more than three (eg John Doe, Jane Smith, and 3 others)"})),isLast:this.props.isLast,isPrivate:this.getIsRecordPrivateToUser(e.navigable_block_id,"block"),rootStore:this.props.rootStore,navigableBlockId:e.navigable_block_id,notification:this.props.notification,icon:a()(we,{authors:l}),showSnapshotButton:!1},void 0,this.renderCommentContext({activity:e,url:h,onClick:u}),a()(Ge,{visible:5,items:e.edits.map(((e,t,i)=>a()(xe.Z,{onClick:u,href:h,innerStyle:We.editButtonStyle},t,a()(Oe.Z,{edit:e,rootStore:this.props.rootStore}))))}),this.renderCommentActions(e,s))}renderCommentContext(e){const{url:t,onClick:i}=e,o=this.getDiscussionContextAndId();if(!o)return;const{id:r,context:s}=o,n=0===(0,N.ll)(s).length,d=(0,W.IY)({environment:this.environment,textValue:{value:s,spaceId:this.props.activity.space_id},parentStore:this.props.rootStore,disableHover:!0,disableStyleAnnotations:!1,disableDateStyleAnnotations:!1,disabled:!0,highlightDiscussionId:r,theme:this.theme,emojiType:(0,H.e)(this.environment),katex:this.environment.KatexStore.getKatex(),enableEndOfLineMarker:!1});return a()(xe.Z,{href:t,onClick:i,innerStyle:{...We.editButtonStyle,display:"flex",alignItems:"flex-start",fontSize:14,...n&&{color:this.theme.mediumTextColor},paddingTop:2,paddingBottom:6,marginBottom:0}},void 0,n&&a()("div",{style:{flexShrink:0,alignSelf:"center",width:3,borderRadius:3,marginLeft:2,marginRight:8,height:20,background:v.DB}}),a()("div",{style:{...Z.Z.textOverflowStyle}},void 0,d))}renderCommentActions(e,t){const i=this.getRecordValue({table:M.qF,id:e.discussion_id,spaceId:e.space_id});if(!i)return;const o=(0,Q.Kv)(this.props.rootStore,{table:M.qF,id:i.id,spaceId:(0,y.CG)(this.props.rootStore.pointer.spaceId)}),r=Y.Z.createChildStore(this.props.rootStore,{table:_.iU,id:i.parent_id});return a()("div",{style:{paddingLeft:52,paddingTop:12,paddingBottom:4}},void 0,a()(Ve.Z,{onClick:e=>{const t=e.target;(0,q.oK)({environment:this.environment,discussionStore:o,rect:t.getBoundingClientRect(),blockStore:r})},style:this.getActionButtonStyle()},void 0,a()(L.FormattedMessage,{defaultMessage:"Reply",id:"activity.replyButton.label"})),this.canUnarchive()&&a()(h.Fragment,{},void 0,Ke,a()(Ve.Z,{onClick:this.handleUnarchive,style:this.getActionSecondaryButtonStyle()},void 0,a()(L.FormattedMessage,{defaultMessage:"Unarchive",id:"activity.unarchiveButton.label"}))))}renderAccessRequestedActions(e){const{rootStore:t}=this.props;if(!(e.edits||[])[0])return;const i=(0,Q.Kv)(t,{table:A.J8,id:e.access_request_id}),o=i.getValue();if(!o||o.parent_table!==_.iU)return;const r=Y.Z.createChildStore(t,{table:_.iU,id:o.parent_id});return r.canAdmin()?a()("div",{style:We.actionPrimaryContainerStyle},void 0,a()(Le,{accessRequestStore:i,targetBlockStore:r,initialRole:"reader",buttonStyle:this.getActionButtonStyle(),notification:this.props.notification})):void 0}renderNotificationActions(){if(this.canUnarchive())return a()("div",{style:We.actionContainerStyle},void 0,a()(Ve.Z,{onClick:this.handleUnarchive,style:this.getActionSecondaryButtonStyle()},void 0,a()(L.FormattedMessage,{defaultMessage:"Unarchive",id:"activity.actions.unarchiveButton.label"})));const e=this.getFollowStore();if(!e)return;const t=e.getValue();return t?t.following?a()("div",{style:We.actionPrimaryContainerStyle},void 0,a()(Ve.Z,{onClick:this.handleUnfollow,style:this.getActionButtonStyle()},void 0,a()(L.FormattedMessage,{defaultMessage:"Unfollow this page",id:"activity.unfollowPageButton.label"}))):a()("div",{style:We.actionPrimaryContainerStyle},void 0,a()(Ve.Z,{onClick:this.handleFollow,style:this.getActionButtonStyle()},void 0,a()(L.FormattedMessage,{defaultMessage:"Re-follow this page",id:"activity.refollowPageButton.label"}))):void 0}renderUserInvitedActivity(e){if(!e.edits)return;let t,i,o;const r=this.getAuthors(e.edits),s=Je(r),n=0===r.filter(p.uC).length,d=parseInt(e.end_time),h=e.edits[0];if(h.navigable_block_id){const r=this.getBlockValue(h.navigable_block_id);if(!r)return;const l=this.renderTitle("block",r),c=(0,R.$e)(r,e);if(c){const t=this.getRecordValue({table:O.Tu,id:c,spaceId:e.space_id});t&&t.message&&t.created_time<=d+5*F.hM&&(o={message:null==t?void 0:t.message,url:(0,g.Om)({table:_.iU,value:r,getRecordValue:this.getRecordValue})})}i=a()(L.FormattedMessage,n?{defaultMessage:"You have been invited to {blockName}",values:{blockName:l},id:"activity.userInvitedActivityNavigableBlockByBot.header"}:{defaultMessage:"{authorOrAuthors} invited you to {blockName}",values:{authorOrAuthors:s,blockName:l},id:"activity.userInvitedActivityNavigableBlock.header",description:"Notification header for updates. The authorOrAuthors variable will be either a name (eg John Doe), two names (eg John Doe and Jane Smith), or more than three (eg John Doe, Jane Smith, and 3 others)"}),t=this.getIsRecordPrivateToUser(r.id,"block")}else if(h.permission_group_id){const e=(0,S.Bg)({spaceId:h.space_id,permissionGroupId:h.permission_group_id,getRecordValue:this.getRecordValue}),o=this.renderPermissionGroupTitle(e,h.space_id);i=a()(L.FormattedMessage,n?{defaultMessage:"You have been added to group {groupName}}}",values:{groupName:o},id:"activity.userInvitedActivityGroupIdByBot.header"}:{defaultMessage:"{authorOrAuthors} added you to group {groupName}",values:{authorOrAuthors:s,groupName:o},id:"activity.userInvitedActivityGroupId.header",description:"Notification header for updates. The authorOrAuthors variable will be either a name (eg John Doe), two names (eg John Doe and Jane Smith), or more than three (eg John Doe, Jane Smith, and 3 others)"}),t=this.getIsRecordPrivateToUser(h.space_id,"space")}else{const e=this.getSpaceValue(h.space_id);if(!e)return;const o=this.renderTitle("space",e);i=a()(L.FormattedMessage,n?{defaultMessage:"You have been invited to {spaceName}",values:{spaceName:o},id:"activity.userInvitedActivityOtherInviteByBot.header"}:{defaultMessage:"{authorOrAuthors} invited you to {spaceName}",values:{authorOrAuthors:s,spaceName:o},id:"activity.userInvitedActivityOtherInvite.header",description:"Notification header for updates. The authorOrAuthors variable will be either a name (eg John Doe), two names (eg John Doe and Jane Smith), or more than three (eg John Doe, Jane Smith, and 3 others)"}),t=this.getIsRecordPrivateToUser(h.space_id,"space")}const l=n?void 0:a()(we,{authors:r});return a()(Me,{timestamp:d,header:a()("span",{},void 0,i),isLast:this.props.isLast,isPrivate:t,rootStore:this.props.rootStore,navigableBlockId:e.navigable_block_id,notification:this.props.notification,icon:l,showSnapshotButton:!1},void 0,o&&a()(xe.Z,{href:o.url,onClick:()=>this.track("click_user_invited"),innerStyle:this.getInviteMessageStyle()},void 0,o.message))}renderTeamMembershipEditedActivity(e){if(!e.edits)return;const t=this.getAuthors(e.edits),i=Je(t),o=e.edits[0],r=this.getTeamValue(o.team_id);if(!r)return;const s=this.renderTeamTitle("team",r),n=a()(L.FormattedMessage,{defaultMessage:"{authorOrAuthors} invited you to {teamName} team",values:{authorOrAuthors:i,teamName:s},id:"activity.userInvitedToTeamActivity.header",description:"Notification header for updates. The authorOrAuthors variable will be either a name (eg John Doe), two names (eg John Doe and Jane Smith), or more than three (eg John Doe, Jane Smith, and 3 others)"});return a()(Me,{timestamp:parseInt(e.end_time),header:a()("span",{},void 0,n),isLast:this.props.isLast,isPrivate:!1,rootStore:this.props.rootStore,notification:this.props.notification,icon:a()(we,{authors:t}),showSnapshotButton:!1})}renderCollectionEdited(e){if(!e.edits)return;const t=this.getRecordValue({table:w.v,id:e.collection_id,spaceId:e.space_id});if(!t)return;const i=e.edits[0];if(!i)return;const o=(0,g.Om)({table:w.v,value:t,getRecordValue:this.getRecordValue}),r=this.getAuthors(e.edits),s=Je(r),n=this.renderTitle("collection",t),d="collection-created"===i.type?a()(L.FormattedMessage,{defaultMessage:"{authorOrAuthors} created {collectionTitle}",values:{authorOrAuthors:s,collectionTitle:n},id:"activity.collectionCreated.header",description:"Notification header for updates. The authorOrAuthors variable will be either a name (eg John Doe), two names (eg John Doe and Jane Smith), or more than three (eg John Doe, Jane Smith, and 3 others)"}):a()(L.FormattedMessage,{defaultMessage:"{authorOrAuthors} edited {collectionTitle}",values:{authorOrAuthors:s,collectionTitle:n},id:"activity.collectionEdited.header",description:"Notification header for updates. The authorOrAuthors variable will be either a name (eg John Doe), two names (eg John Doe and Jane Smith), or more than three (eg John Doe, Jane Smith, and 3 others)"});return a()(Me,{timestamp:parseInt(e.end_time),header:a()("span",{},void 0,d),isLast:this.props.isLast,isPrivate:this.getIsRecordPrivateToUser(e.collection_id,"collection"),rootStore:this.props.rootStore,navigableBlockId:e.navigable_block_id,notification:this.props.notification,icon:a()(we,{authors:r}),showSnapshotButton:this.props.isTopbarUpdatesMenu},void 0,u.OC(i)&&this.renderCollectionDescriptionEdit(i,o),this.renderNotificationActions())}renderCollectionDescriptionEdit(e,t){return a()(xe.Z,{href:t,innerStyle:We.editButtonStyle},void 0,a()(Oe.Z,{edit:e,rootStore:this.props.rootStore}))}renderCollectionViewEdited(e){if(!e.edits)return;const t=this.getRecordValue({table:w.v,id:e.collection_id,spaceId:e.space_id});if(!t)return;const i=this.getRecordValue({table:T.n,id:e.collection_view_id,spaceId:e.space_id});if(!i)return;const o=(0,P.hI)(e.edits)[0];if(!o)return;const r=this.renderCollectionViewTitle(i),s=this.renderTitle("collection",t),n=this.getAuthors(e.edits),d=Je(n);let h;return h="collection-view-created"===o.type?a()(L.FormattedMessage,{defaultMessage:"{authorOrAuthors} created view {collectionViewTitle} in {collectionTitle}",values:{authorOrAuthors:d,collectionTitle:s,collectionViewTitle:r},id:"activity.collectionViewCreated.header",description:"Notification header for updates. The authorOrAuthors variable will be either a name (eg John Doe), two names (eg John Doe and Jane Smith), or more than three (eg John Doe, Jane Smith, and 3 others)"}):"collection-view-deleted"===o.type?a()(L.FormattedMessage,{defaultMessage:"{authorOrAuthors} deleted view {collectionViewTitle} in {collectionTitle}",values:{authorOrAuthors:d,collectionTitle:s,collectionViewTitle:r},id:"activity.collectionViewDeleted.header",description:"Notification header for updates. The authorOrAuthors variable will be either a name (eg John Doe), two names (eg John Doe and Jane Smith), or more than three (eg John Doe, Jane Smith, and 3 others)"}):a()(L.FormattedMessage,{defaultMessage:"{authorOrAuthors} edited view {collectionViewTitle} in {collectionTitle}",values:{authorOrAuthors:d,collectionTitle:s,collectionViewTitle:r},id:"activity.collectionViewEdited.header",description:"Notification header for updates. The authorOrAuthors variable will be either a name (eg John Doe), two names (eg John Doe and Jane Smith), or more than three (eg John Doe, Jane Smith, and 3 others)"}),a()(Me,{timestamp:parseInt(e.end_time),header:a()("span",{},void 0,h),isLast:this.props.isLast,isPrivate:this.getIsRecordPrivateToUser(e.collection_id,"collection"),rootStore:this.props.rootStore,navigableBlockId:e.navigable_block_id,notification:this.props.notification,icon:a()(we,{authors:n}),showSnapshotButton:this.props.isTopbarUpdatesMenu},void 0,this.renderNotificationActions())}renderCollectionPropertyEdited(e){if(!e.edits)return;const t=(0,P.hI)(e.edits)[0];if(!t)return;const i=this.getRecordValue({table:w.v,id:e.collection_id,spaceId:e.space_id});if(!i)return;const o="collection-property-changed"===t.type?t.collection_property_data.after:t.collection_property_data,r=this.getAuthors(e.edits),s=Je(r),n=this.renderTitle("collection",i),d=this.renderCollectionPropertyTitle(o);let h;return h="collection-property-created"===t.type?a()(L.FormattedMessage,{defaultMessage:"{authorOrAuthors} created property {collectionPropertyTitle} in {collectionTitle}",values:{authorOrAuthors:s,collectionTitle:n,collectionPropertyTitle:d},id:"activity.collectionPropertyCreated.header",description:"Notification header for updates. The authorOrAuthors variable will be either a name (eg John Doe), two names (eg John Doe and Jane Smith), or more than three (eg John Doe, Jane Smith, and 3 others)"}):"collection-property-deleted"===t.type?a()(L.FormattedMessage,{defaultMessage:"{authorOrAuthors} deleted property {collectionPropertyTitle} in {collectionTitle}",values:{authorOrAuthors:s,collectionTitle:n,collectionPropertyTitle:d},id:"activity.collectionPropertyDeleted.header",description:"Notification header for updates. The authorOrAuthors variable will be either a name (eg John Doe), two names (eg John Doe and Jane Smith), or more than three (eg John Doe, Jane Smith, and 3 others)"}):a()(L.FormattedMessage,{defaultMessage:"{authorOrAuthors} edited property {collectionPropertyTitle} in {collectionTitle}",values:{authorOrAuthors:s,collectionTitle:n,collectionPropertyTitle:d},id:"activity.collectionPropertyEdited.header",description:"Notification header for updates. The authorOrAuthors variable will be either a name (eg John Doe), two names (eg John Doe and Jane Smith), or more than three (eg John Doe, Jane Smith, and 3 others)"}),a()(Me,{timestamp:parseInt(e.end_time),header:a()("span",{},void 0,h),isLast:this.props.isLast,isPrivate:this.getIsRecordPrivateToUser(e.collection_id,"collection"),rootStore:this.props.rootStore,navigableBlockId:e.navigable_block_id,notification:this.props.notification,icon:a()(we,{authors:r}),showSnapshotButton:this.props.isTopbarUpdatesMenu},void 0,this.renderNotificationActions())}renderReminderActivity(e){if(!e.edits)return;const t=e.edits[0],i=this.getBlockValue(t.navigable_block_id);if(!i)return;const o=this.getBlockValue(e.reminder_block_id);if(!o)return;const r=(0,g.Om)({table:"block",value:o,getRecordValue:this.getRecordValue});return a()(Me,{timestamp:parseInt(e.end_time),header:a()("span",{},void 0,a()(L.FormattedMessage,{defaultMessage:"Reminder in {pageTitle}",id:"activity.reminderInActivity.header",values:{pageTitle:this.renderTitle("block",i)}})),isLast:this.props.isLast,isPrivate:this.getIsRecordPrivateToUser(i.id,"block"),rootStore:this.props.rootStore,navigableBlockId:i.id,notification:this.props.notification,icon:a()(Te,{}),showSnapshotButton:!1},void 0,a()(xe.Z,{href:r,onClick:()=>this.track("reminder_edit"),innerStyle:We.editButtonStyle},void 0,a()(Oe.Z,{edit:t,rootStore:this.props.rootStore})),this.renderNotificationActions())}renderPageLockActivity(e){if(!e.edits)return;const t=e.edits[0],i=this.getBlockValue(t.navigable_block_id);if(!i)return;const o=this.getAuthors(e.edits),r=Je(o),s=this.renderTitle("block",i),n="page-locked"===e.type?a()(L.FormattedMessage,{defaultMessage:"{authorOrAuthors} locked {blockTitle}",values:{authorOrAuthors:r,blockTitle:s},id:"activity.pageLocked.header",description:"Notification header for updates. The authorOrAuthors variable will be either a name (eg John Doe), two names (eg John Doe and Jane Smith), or more than three (eg John Doe, Jane Smith, and 3 others)"}):a()(L.FormattedMessage,{defaultMessage:"{authorOrAuthors} unlocked {blockTitle}",values:{authorOrAuthors:r,blockTitle:s},id:"activity.pageUnlocked.header",description:"Notification header for updates. The authorOrAuthors variable will be either a name (eg John Doe), two names (eg John Doe and Jane Smith), or more than three (eg John Doe, Jane Smith, and 3 others)"});return a()(Me,{timestamp:parseInt(e.end_time),header:a()("span",{},void 0,n),isPrivate:this.getIsRecordPrivateToUser(i.id,"block"),isLast:this.props.isLast,rootStore:this.props.rootStore,navigableBlockId:i.id,notification:this.props.notification,icon:a()(we,{authors:o}),showSnapshotButton:!1},void 0,this.renderNotificationActions())}renderEmailEdited(e){if(!e.edits)return;const t=e.edits[0];if(!t)return;const i=this.getAuthors(e.edits),o=Je(i);return a()(Me,{timestamp:parseInt(e.end_time),header:a()("span",{},void 0,a()(L.FormattedMessage,{defaultMessage:"{authorOrAuthors} changed email from {oldEmail} to {newEmail}",values:{authorOrAuthors:o,oldEmail:t.old_email,newEmail:t.new_email},id:"activity.emailEdited.header",description:"Notification header for updates. The authorOrAuthors variable will be either a name (eg John Doe), two names (eg John Doe and Jane Smith), or more than three (eg John Doe, Jane Smith, and 3 others)"})),isLast:this.props.isLast,isPrivate:!1,rootStore:this.props.rootStore,notification:this.props.notification,icon:a()(we,{authors:i}),showSnapshotButton:!1})}renderAccessRequested(e){if(!e.edits)return;const t=e.edits[0];if(!t)return;const i=this.getBlockValue(e.navigable_block_id);if(!i)return;const o=this.getAuthors(e.edits),r=Je(o),{message:s}=t;return a()(Me,{timestamp:parseInt(e.end_time),header:a()("span",{},void 0,a()(L.FormattedMessage,{defaultMessage:"{authorOrAuthors} requested access to {pageName}",values:{authorOrAuthors:r,pageName:this.renderTitle(_.iU,i)},id:"activity.accessRequested.header",description:"Notification header for updates. The authorOrAuthors variable will be either a name (eg John Doe), two names (eg John Doe and Jane Smith), or more than three (eg John Doe, Jane Smith, and 3 others)"})),isLast:this.props.isLast,isPrivate:!1,rootStore:this.props.rootStore,notification:this.props.notification,icon:a()(we,{authors:o}),showSnapshotButton:!1},void 0,s&&a()("div",{style:{paddingLeft:52,paddingRight:16,marginTop:8,marginBottom:8}},void 0,a()(Ze.Z,{isSmall:!0},void 0,a()(L.FormattedMessage,{id:"activity.accessRequested.messageLabel",defaultMessage:"Message from {author}",values:{author:r}})),a()(Ze.Z,{isMultiline:!0,style:{whiteSpace:"pre-wrap"}},void 0,s)),this.renderAccessRequestedActions(e),this.renderNotificationActions())}renderPageDeleteOrRestoreActivity(e){if(!e.edits)return;const t=e.edits[0];if(!t)return;const i=this.getRecordValue({table:_.iU,id:t.navigable_block_id,spaceId:t.space_id});if(!i)return;const o=this.getAuthors(e.edits),r=Je(o),s=this.renderTitle(_.iU,i);let n;return"page-deleted"===e.type?n=a()(L.FormattedMessage,{defaultMessage:"{authorOrAuthors} deleted {blockTitle}",values:{authorOrAuthors:r,blockTitle:s},id:"emailActivity.pageDeleted.header",description:"Notification header for updates. The authorOrAuthors variable will be either a name (eg John Doe), two names (eg John Doe and Jane Smith), or more than three (eg John Doe, Jane Smith, and 3 others)"}):"page-restored"===e.type?n=a()(L.FormattedMessage,{defaultMessage:"{authorOrAuthors} restored {blockTitle}",values:{authorOrAuthors:r,blockTitle:s},id:"emailActivity.pageDeleted.header",description:"Notification header for updates. The authorOrAuthors variable will be either a name (eg John Doe), two names (eg John Doe and Jane Smith), or more than three (eg John Doe, Jane Smith, and 3 others)"}):"page-permanently-deleted"===e.type?n=a()(L.FormattedMessage,{defaultMessage:"{authorOrAuthors} permanently deleted {blockTitle}",values:{authorOrAuthors:r,blockTitle:s},id:"emailActivity.pageDeleted.header",description:"Notification header for updates. The authorOrAuthors variable will be either a name (eg John Doe), two names (eg John Doe and Jane Smith), or more than three (eg John Doe, Jane Smith, and 3 others)"}):(0,V.t1)(e),a()(Me,{timestamp:parseInt(e.end_time),header:a()("span",{},void 0,n),isPrivate:this.getIsRecordPrivateToUser(i.id,"block"),isLast:this.props.isLast,rootStore:this.props.rootStore,navigableBlockId:i.id,notification:this.props.notification,icon:a()(we,{authors:o}),showSnapshotButton:!1},void 0,this.renderNotificationActions())}renderCollectionPropertyTitle(e){return a()("span",{style:{...We.boldStyle,whiteSpace:"nowrap"}},void 0,a()(f.Z,{type:e.type,size:12,style:We.svgIconStyle,theme:this.theme,isDark:!0})," ",e.name)}renderCollectionViewTitle(e){const t=(0,g.WE)({collectionView:e,getRecordValue:this.getRecordValue});return a()(xe.Z,{href:t,onClick:()=>this.track("click_title"),external:!1,innerStyle:{...We.pageLinkStyle,...We.boldStyle},inline:!0},void 0,this.renderCollectionViewTypeIcon(e.type)," ",a()(Be.Z,{collectionViewName:e.name,collectionViewType:e.type}))}renderCollectionViewTypeIcon(e){const t=We.svgIconStyle;return z.aW[e](t)}getStore(e,t){return"collection"===e?X.Z.createChildStore(this.props.rootStore,{table:w.v,id:t}):"space"===e?ee.Z.createChildStore(this.props.rootStore,{table:D.bx,id:t}):"team"===e?te.Z.createChildStore(this.props.rootStore,{table:I.e0,id:t}):"block"===e?Y.Z.createChildStore(this.props.rootStore,{table:_.iU,id:t}):void(0,V.t1)(e)}renderTitle(e,t){const i=this.getStore(e,t.id),o=(0,g.Al)({table:e,value:t,getRecordValue:this.getRecordValue}),r=(0,g.Om)({table:e,value:t,getRecordValue:this.getRecordValue});return a()(xe.Z,{href:r,onClick:()=>this.track("click_title"),external:!1,innerStyle:We.pageLinkStyle,inline:!0},void 0,o&&l().createElement(l().Fragment,null,a()(Ue.Z,{disabled:!0,icon:o,isEmptyPage:!1,size:18,style:We.recordIconStyle}),a()("span",{},void 0," ")),a()(Ee.Z,{store:i,style:this.getActivityTitleStyle(void 0!==o)}))}renderTeamTitle(e,t){const i=te.Z.createChildStore(this.props.rootStore,{table:I.e0,id:t.id}),o=(0,g.Al)({table:e,value:t,getRecordValue:this.getRecordValue});return a()(xe.Z,{onClick:e=>{this.environment.device.isMobile||(this.track("click_user_invited_to_team"),(0,G.JX)(i),ie.Z.setState({...ie.Z.state,open:!1}),U.go(this.environment))},external:!1,innerStyle:We.pageLinkStyle,inline:!0},void 0,o&&l().createElement(l().Fragment,null,a()(Ue.Z,{disabled:!0,icon:o,isEmptyPage:!1,size:18,style:We.recordIconStyle}),a()("span",{},void 0," ")),a()(Ee.Z,{store:i,style:this.getActivityTitleStyle(void 0!==o)}))}renderPermissionGroupTitle(e,t){let i,o;return e?(i=e.icon,o=e.name||a()(L.FormattedMessage,{defaultMessage:"Untitled group",id:"activity.permissionGroupTitles.untitledGroup"})):o=a()(L.FormattedMessage,{defaultMessage:"Deleted group",id:"activity.permissionGroupTitles.deletedGroup"}),a()("span",{},void 0,i&&a()(Ue.Z,{disabled:!0,icon:{icon:i,pointer:{table:"space",id:t}},isEmptyPage:!1,size:18,style:We.recordIconStyle}),a()("span",{style:this.getActivityTitleStyle(void 0!==i)},void 0,o))}renderPermissionGroupEditedHeader(e){const{activity:t,authors:i,groupName:o}=e,r=Je(i),s=(0,P.hI)(t.edits||[])[0];return s?"permission-group-created"===s.type?a()(L.FormattedMessage,{defaultMessage:"{authorOrAuthors} created group {groupName}",values:{authorOrAuthors:r,groupName:a()("span",{style:We.boldStyle},void 0,o)},id:"activity.updatedPermissionGroupCreated.header",description:"Notification header for updates. The authorOrAuthors variable will be either a name (eg John Doe), two names (eg John Doe and Jane Smith), or more than three (eg John Doe, Jane Smith, and 3 others)"}):"permission-group-deleted"===s.type?a()(L.FormattedMessage,{defaultMessage:"{authorOrAuthors} deleted group {groupName}",values:{authorOrAuthors:r,groupName:a()("span",{style:We.boldStyle},void 0,o)},id:"activity.updatedPermissionGroupDeleted.header",description:"Notification header for updates. The authorOrAuthors variable will be either a name (eg John Doe), two names (eg John Doe and Jane Smith), or more than three (eg John Doe, Jane Smith, and 3 others)"}):a()(L.FormattedMessage,{defaultMessage:"{authorOrAuthors} edited group {groupName}",values:{authorOrAuthors:r,groupName:a()("span",{style:We.boldStyle},void 0,o)},id:"activity.updatedPermissionGroupEditedDefault.header",description:"Notification header for updates. The authorOrAuthors variable will be either a name (eg John Doe), two names (eg John Doe and Jane Smith), or more than three (eg John Doe, Jane Smith, and 3 others)"}):a()(L.FormattedMessage,{defaultMessage:"{authorOrAuthors} edited group {groupName}",values:{authorOrAuthors:r,groupName:a()("span",{style:We.boldStyle},void 0,o)},id:"activity.updatedPermissionGroupEdit.header",description:"Notification header for updates. The authorOrAuthors variable will be either a name (eg John Doe), two names (eg John Doe and Jane Smith), or more than three (eg John Doe, Jane Smith, and 3 others)"})}canUnarchive(){const{notification:e}=this.props;return!!e&&!!e.visited}getFollowStore(){if("following"!==oe.Z.state.currentTab)return;const{notification:e}=this.props;if(!e)return;let t=e.navigable_block_id;if(!t){if(!e.collection_id)return;const i=(0,Q.Kv)(this.props.rootStore,{table:w.v,id:e.collection_id,spaceId:e.space_id}).getValue();if(!i)return;t=i.parent_id}const i=this.environment.currentUser.id;if(!i)return;const o=(0,B.$j)({user_id:i,navigable_block_id:t});return(0,Q.Kv)(this.props.rootStore,{table:B.t0,id:o,spaceId:e.space_id})}setFollowing(e){const t=this.getFollowStore();t&&K.createAndCommit({userAction:"Activity.setFollowing",environment:this.environment,perform:i=>{E.sW({store:t,transaction:i,data:{following:e}})}})}get getRecordValue(){return this.props.rootStore.getRecordValue}getBlockStore(e){return Y.Z.createChildStore(this.props.rootStore,{table:_.iU,id:e})}getBlockValue(e){return this.getBlockStore(e).getValue()}getAuthors(e){const t=d().uniqWith(d().flatten(e.map((e=>e.authors||[]))),d().isEqual);return d().compact(t.map(this.getAuthorActor))}track(e){(0,x.W3P)(this.environment,this.props.analyticsContext,{target:e,type:u.Fb(this.props.activity)})}getIsRecordPrivateToUser(e,t){const{source:i}=this.props;if("all_updates"===i){if(!e)return!1;let i;return i="block"===t?Y.Z.createChildStore(this.props.rootStore,{table:_.iU,id:e}):"collection"===t?X.Z.createChildStore(this.props.rootStore,{table:w.v,id:e}):ee.Z.createChildStore(this.props.rootStore,{table:D.bx,id:e}),(0,$.yi)(this.environment,i)}return!1}getActionButtonStyle(){return{boxShadow:this.theme.plainButtonBoxShadow,height:26,paddingLeft:8,paddingRight:8,fontWeight:500,color:this.theme.regularTextColor}}getActionSecondaryButtonStyle(){return{height:26,paddingLeft:8,paddingRight:8,color:this.theme.mediumTextColor}}getInviteMessageStyle(){return{paddingLeft:52,paddingTop:8,paddingBottom:8,paddingRight:12,fontSize:14}}getActivityTitleStyle(e){return{display:"inline",whiteSpace:"normal",marginRight:e?3:0,wordBreak:"break-word",...We.boldStyle}}}r()(We,"actionContainerStyle",{paddingLeft:44,paddingTop:4}),r()(We,"actionPrimaryContainerStyle",{paddingLeft:52,paddingTop:12,paddingBottom:8}),r()(We,"canSelectStyle",{userSelect:"text",WebkitUserSelect:"text"}),r()(We,"boldStyle",{fontWeight:Z.Z.fontWeight.semibold}),r()(We,"pageLinkStyle",{padding:1,...We.canSelectStyle}),r()(We,"recordIconStyle",{display:"inline-flex",marginRight:2,verticalAlign:"text-top"}),r()(We,"svgIconStyle",{width:12,height:12,display:"inline",verticalAlign:"middle",marginBottom:2,marginLeft:2}),r()(We,"editButtonStyle",{padding:0,paddingLeft:52,paddingRight:16,...We.canSelectStyle});const ze=We}}]);